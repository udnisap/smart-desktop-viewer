
//RTCMultiConnection.js
!function(){function e(e,n){function u(n){return n.data.checkingPresence&&e.channels[n.userid]?void e.channels[n.userid].send({presenceDetected:!0}):n.data.presenceDetected&&e.peers[n.userid]?void(e.peers[n.userid].connected=!0):void("text"===n.data.type?ee.receive(n.data,n.userid,n.extra):e.autoTranslateText?(n.original=n.data,e.Translator.TranslateText(n.data,function(t){n.data=t,e.onmessage(n)})):e.onmessage(n))}function M(n){return e.skipOnNewSession||(n.session||(n.session={}),n.extra||(n.extra={}),e.sessionid&&n.sessionid!=e.sessionid)?void 0:e.onNewSession?(n.join=function(t){if(!t)return e.join(n);for(var i in t)n.session[i]=t[i];var o=e.dontCaptureUserMedia;e.dontCaptureUserMedia=!1,e.captureUserMedia(function(){e.dontCaptureUserMedia=!0,e.join(n),e.dontCaptureUserMedia=o},t)},n.extra||(n.extra={}),e.onNewSession(n)):void e.join(n)}function O(n){for(var t=0;t<e.localStreamids.length;t++){var i=e.localStreamids[t];e.streams[i]&&e.streams[i].sockets.push(n)}}function E(n){function t(n){return H||W||o(e.waitUntilRemoteStreamStartsFlowing)||!e.waitUntilRemoteStreamStartsFlowing?l(n):(n.numberOfTimes||(n.numberOfTimes=0),n.numberOfTimes++,n.mediaElement.readyState<=HTMLMediaElement.HAVE_CURRENT_DATA||n.mediaElement.paused||n.mediaElement.currentTime<=0?n.numberOfTimes>=60?U.send({failedToReceiveRemoteVideo:!0,streamid:n.stream.streamid}):void setTimeout(function(){m("Waiting for incoming remote stream to be started flowing: "+n.numberOfTimes+" seconds."),t(n)},900):l(n))}function d(){if(e.fakeDataChannels&&!e.channels[n.userid]&&!e.session.data){var t={send:function(e){U.send({fakeData:e})},readyState:"open"};e.channels[n.userid]={channel:t,send:function(e){this.channel.send(e)}},_.onopen(t)}}function l(t){var i=t.mediaElement,o=t.session,s=t.stream;s.onended=function(){a.mediaElement&&!a.mediaElement.parentNode&&document.getElementById(s.streamid)&&(a.mediaElement=document.getElementById(s.streamid)),g(a,e)};var a={mediaElement:i,stream:s,streamid:s.streamid,session:o||e.session,blobURL:W?"":i.mozSrcObject?URL.createObjectURL(s):i.src,type:"remote",extra:n.extra,userid:n.userid,isVideo:W?!!o.video:!!s.isVideo,isAudio:W?!!o.audio&&!o.video:!!s.isAudio,isScreen:!!s.isScreen,isInitiator:!!n.isInitiator,rtcMultiConnection:e,socket:U};if(e.streams[s.streamid]=e._getStream(a),e.onstream(a),!r(t.preMuted)&&(t.preMuted.audio||t.preMuted.video)){var d=b({},a);d.session=b(d.session,t.preMuted),d.isAudio=!!d.session.audio&&!d.session.video,d.isVideo=!!d.session.video,d.isScreen=!1,e.onmute(d)}m("on:add:stream",a),x(),e.onspeaking&&D({stream:s,streamedObject:a,connection:e})}function C(t){n.channel=t,e.channels[n.userid]={channel:n.channel,send:function(n){e.send(n,this.channel)}},e.onopen({extra:n.extra,userid:n.userid,channel:t});for(var o in e.fileQueue)e.send(e.fileQueue[o],t);i(e.session)&&x(),e.partOfScreen&&e.partOfScreen.sharing&&e.peers[n.userid].sharePartOfScreen(e.partOfScreen)}function R(){U.userid!=n.userid&&(U.userid=n.userid,K[n.socketIndex]=U,e.numberOfConnectedUsers++,e.peers[n.userid]={socket:U,peer:N,userid:n.userid,extra:n.extra,userinfo:n.userinfo,addStream:function(n){e.addStream(n,this.socket)},removeStream:function(n){return e.streams[n]?(this.peer.connection.removeStream(e.streams[n].stream),void this.renegotiate()):f("No such stream exists. Stream-id:",n)},renegotiate:function(n,t){e.renegotiate(n,t)},changeBandwidth:function(e){if(!e)throw"You MUST pass bandwidth object.";if(s(e))throw"Pass object for bandwidth instead of string; e.g. {audio:10, video:20}";this.peer.bandwidth=e,this.socket.send({changeBandwidth:!0,bandwidth:e})},sendCustomMessage:function(e){this.socket.send({customMessage:!0,message:e})},onCustomMessage:function(e){m('Received "private" message from',this.userid,s(e)?e:p(e))},drop:function(n){for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],t.userid==e.userid&&"local"==t.type&&(this.peer.connection.removeStream(t.stream),g(t,e)),"remote"==t.type&&t.userid==this.userid&&g(t,e));!n&&this.socket.send({drop:!0})},hold:function(n){return"answer"==N.prevCreateType?void this.socket.send({unhold:!0,holdMLine:n||"both",takeAction:!0}):(this.socket.send({hold:!0,holdMLine:n||"both"}),this.peer.hold=!0,void this.fireHoldUnHoldEvents({kind:n,isHold:!0,userid:e.userid,remoteUser:this.userid}))},unhold:function(n){return"answer"==N.prevCreateType?void this.socket.send({unhold:!0,holdMLine:n||"both",takeAction:!0}):(this.socket.send({unhold:!0,holdMLine:n||"both"}),this.peer.hold=!1,void this.fireHoldUnHoldEvents({kind:n,isHold:!1,userid:e.userid,remoteUser:this.userid}))},fireHoldUnHoldEvents:function(n){var t=n.isHold,i=n.kind,o=n.remoteUser||n.userid;for(var s in e.streams)-1==e._skip.indexOf(s)&&(s=e.streams[s],s.userid==o&&(t&&e.onhold(b({kind:i},s)),t||e.onunhold(b({kind:i},s))))},redial:function(){for(var n in e.streams)-1==e._skip.indexOf(n)&&(n=e.streams[n],n.userid==this.userid&&"remote"==n.type&&g(n,e));m("ReDialing..."),U.send({recreatePeer:!0}),N=new A,N.create("offer",_)},sharePartOfScreen:function(n){function t(){return i.stopPartOfScreenSharing?(i.stopPartOfScreenSharing=!1,void(e.onpartofscreenstopped&&e.onpartofscreenstopped())):i.pausePartOfScreenSharing?(e.onpartofscreenpaused&&e.onpartofscreenpaused(),setTimeout(t,n.interval||200)):void T({element:n.element,connection:e,callback:function(s){if(!e.channels[i.userid])throw"No such data channel exists.";s!=o&&(o=s,e.channels[i.userid].send({screenshot:s,isPartOfScreen:!0})),!n.once&&setTimeout(t,n.interval||200)}})}var i=this,o="";t()},getConnectionStats:function(n,t){function i(){re.prototype.getConnectionStats=window.getConnectionStats,N.connection&&N.connection.getConnectionStats(n,t)}if(!n)throw"callback is mandatory.";window.getConnectionStats?i():y(e.resources.getConnectionStats,i)},takeSnapshot:function(n){w({userid:this.userid,connection:e,callback:n})}})}function x(){if(e.isInitiator&&h(Z)&&h(Z)<=e.maxParticipantsAllowed&&(e.session.oneway||e.session.broadcast||ne.send({sessionid:e.sessionid,newParticipant:n.userid||U.channel,userData:{userid:n.userid||U.channel,extra:n.extra}})),"chrome"==n.userinfo.browser&&!n.renegotiatedOnce)for(var t in e.renegotiatedSessions)n.renegotiatedOnce=!0,e.renegotiatedSessions[t]&&e.renegotiatedSessions[t].stream&&e.peers[n.userid].renegotiate(e.renegotiatedSessions[t].stream,e.renegotiatedSessions[t].session)}function M(t){if(!te&&t.userid!=e.userid){if(t.sdp){n.userid=t.userid,n.extra=t.extra||{},n.renegotiate=t.renegotiate,n.streaminfo=t.streaminfo,n.isInitiator=t.isInitiator,n.userinfo=t.userinfo;var i=JSON.parse(t.sdp);"offer"==i.type&&(_.preferSCTP=!!t.preferSCTP,e.fakeDataChannels=!!t.fakeDataChannels),d(),E(i,t.labels)}if(t.candidate&&N&&N.addIceCandidate(JSON.parse(t.candidate)),t.streamid&&($.streamids||($.streamids={}),$.streamids[t.streamid]||($.streamids[t.streamid]=t.streamid,e.onstreamid(t))),t.mute||t.unmute)if(t.promptMuteUnmute){if(!e.privileges.canMuteRemoteStream)return void e.onstatechange({userid:t.userid,extra:t.extra,name:"mute-request-denied",reason:t.userid+' tried to mute your stream; however "privileges.canMuteRemoteStream" is "false".'});e.streams[t.streamid]&&(t.mute&&!e.streams[t.streamid].muted&&e.streams[t.streamid].mute(t.session),t.unmute&&e.streams[t.streamid].muted&&e.streams[t.streamid].unmute(t.session))}else{var o={};e.streams[t.streamid]&&(o=e.streams[t.streamid]);var s=t.session,r=b({},o);r.session=s,r.isAudio=!!r.session.audio&&!r.session.video,r.isVideo=!!r.session.video,r.isScreen=!!r.session.screen,t.mute&&e.onmute(r||t),t.unmute&&e.onunmute(r||t)}if(t.isVolumeChanged&&(m("Volume of stream: "+t.streamid+" has changed to: "+t.volume),e.streams[t.streamid])){var a=e.streams[t.streamid].mediaElement;a&&(a.volume=t.volume)}if(t.stopped&&e.streams[t.streamid]&&g(e.streams[t.streamid],e),t.promptStreamStop){if(!e.privileges.canStopRemoteStream)return void e.onstatechange({userid:t.userid,extra:t.extra,name:"stop-request-denied",reason:t.userid+' tried to stop your stream; however "privileges.canStopRemoteStream" is "false".'});f("Remote stream has been manually stopped!"),e.streams[t.streamid]&&e.streams[t.streamid].stop()}if(t.left){if(V){var u=t.userid;for(var l in e.streams)l=e.streams[l],l.userid==u&&(e.stopMediaStream(l),g(l,e))}if(N&&N.connection&&("closed"!=N.connection.signalingState&&-1==N.connection.iceConnectionState.search(/disconnected|failed/gi)&&N.connection.close(),N.connection=null),Z[t.userid]&&delete Z[t.userid],t.closeEntireSession)return e.onSessionClosed(t),void e.leave();e.remove(t.userid),S({userid:t.userid,extra:t.extra||{},entireSessionClosed:!!t.closeEntireSession},e)}if(t.playRoleOfBroadcaster&&(t.extra&&(e.extra=b(e.extra,t.extra)),t.participants&&(Z=t.participants,Z[e.userid]&&delete Z[e.userid],K[0]&&K[0].userid==t.userid&&(delete K[0],K=c(K)),X[t.userid]&&delete X[t.userid]),setTimeout(e.playRoleOfInitiator,2e3)),t.changeBandwidth){if(!e.peers[t.userid])throw"No such peer exists.";e.peers[t.userid].peer.bandwidth=t.bandwidth,e.peers[t.userid].renegotiate()}if(t.customMessage){if(!e.peers[t.userid])throw"No such peer exists.";if(t.message.ejected){if(e.sessionDescriptions[e.sessionid].userid!=t.userid)throw"only initiator can eject a user.";e.leave(),e.onSessionClosed({userid:t.userid,extra:t.extra||n.extra,isEjected:!0})}else e.peers[t.userid].onCustomMessage(t.message)}if(t.drop){if(!e.peers[t.userid])throw"No such peer exists.";e.peers[t.userid].drop(!0),e.peers[t.userid].renegotiate(),e.ondrop(t.userid)}if(t.hold||t.unhold){if(!e.peers[t.userid])throw"No such peer exists.";if(t.takeAction)return void e.peers[t.userid][t.hold?"hold":"unhold"](t.holdMLine);e.peers[t.userid].peer.hold=!!t.hold,e.peers[t.userid].peer.holdMLine=t.holdMLine,U.send({isRenegotiate:!0}),e.peers[t.userid].fireHoldUnHoldEvents({kind:t.holdMLine,isHold:!!t.hold,userid:t.userid})}t.isRenegotiate&&e.peers[t.userid].renegotiate(null,e.peers[t.userid].peer.session),t.fakeData&&_.onmessage(t.fakeData),t.recreatePeer&&(N=new A),t.failedToReceiveRemoteVideo&&(m("Remote peer hasn't received stream: "+t.streamid+". Renegotiating..."),e.peers[t.userid]&&e.peers[t.userid].renegotiate()),t.redial&&e.peers[t.userid]&&("disconnected"!=e.peers[t.userid].peer.connection.iceConnectionState&&(n.redialing=!1),"disconnected"!=e.peers[t.userid].peer.connection.iceConnectionState||n.redialing||(n.redialing=!0,f("Peer connection is closed.",p(e.peers[t.userid].peer.connection),"ReDialing.."),e.peers[t.userid].redial()))}}function E(t,o){function s(){N.recreateAnswer(t,r,function(n,t){L({sdp:n,socket:U,streaminfo:t}),e.detachStreams=[]})}if("answer"==t.type)return N.setRemoteDescription(t),void R();if(!n.renegotiate&&"offer"==t.type)return _.offerDescription=t,_.session=e.session,N||(N=new A),N.create("answer",_),void R();var r=n.renegotiate;if(P(o,N.connection),r.oneway||i(r))s(),delete n.renegotiate;else{if(n.capturing)return;n.capturing=!0,e.captureUserMedia(function(t){n.capturing=!1,N.addStream(t),e.renegotiatedSessions[JSON.stringify(n.renegotiate)]={session:n.renegotiate,stream:t},delete n.renegotiate,s()},n.renegotiate)}}var I={channel:n.channel,onmessage:M,onopen:function(t){t&&(U=t),F&&!N&&(_.session=e.session,N||(N=new A),N.create("offer",_)),n.socketIndex=U.index=K.length,X[I.channel]=U,K[n.socketIndex]=U,O(U),U.__push||(U.__push=U.send,U.send=function(n){n.userid=n.userid||e.userid,n.extra=n.extra||e.extra||{},U.__push(n)})}};I.callback=function(e){U=e,I.onopen()};var U=e.openSignalingChannel(I);U&&I.onopen(U);var N,F=n.isofferer,_={onopen:C,onicecandidate:function(n){if(!e.candidates)throw"ICE candidates are mandatory.";if(!e.iceProtocols)throw"At least one must be true; UDP or TCP.";var t=e.candidates,i=t.stun,s=t.turn;if(o(t.reflexive)||(i=t.reflexive),o(t.relay)||(s=t.relay),(t.host||!n.candidate.match(/a=candidate.*typ host/g))&&(s||!n.candidate.match(/a=candidate.*typ relay/g))&&(i||!n.candidate.match(/a=candidate.*typ srflx/g))){var r=e.iceProtocols;(r.udp||!n.candidate.match(/a=candidate.* udp/g))&&(r.tcp||!n.candidate.match(/a=candidate.* tcp/g))&&(window.selfNPObject||(window.selfNPObject=n),U&&U.send({candidate:JSON.stringify({candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex})}))}},onmessage:function(t){if(t){var i=a(t);if(-1!=i.indexOf('"userid":'))i=JSON.parse(i),u(i);else if(t instanceof ArrayBuffer||t instanceof DataView){if(!e.enableFileSharing)throw'It seems that receiving data is either "Blob" or "File" but file sharing is disabled.';if(!$.fileBufferReader){var o=this;return void k(e,function(e){$.fileBufferReader=e,o.onmessage(t)})}var s=$.fileBufferReader;return void s.convertToObject(t,function(t){return t.maxChunks||t.readyForNextChunk?t.readyForNextChunk?void s.getNextChunk(t.uuid,function(e,n,t){$.send(e)}):void s.addChunk(t,function(e){$.send(e)}):void e.onmessage({data:t,userid:n.userid,extra:n.extra})})}}},onaddstream:function(o,s){function r(){setTimeout(function(){u.muted=!1,l({mediaElement:u,session:s,stream:o,preMuted:a})},3e3),u.removeEventListener("play",r)}if(s=s||n.renegotiate||e.session,!i(s)){s.screen&&(s.audio||s.video)&&(n.gotAudioOrVideo?(s.audio=!1,s.video=!1):(n.gotAudioOrVideo=!0,s.screen=!1));var a={};if(n.streaminfo){var d=n.streaminfo.split("----"),c=JSON.parse(d[d.length-1]);j||(o.streamid=c.streamid,o.isScreen=!!c.isScreen,o.isVideo=!!c.isVideo,o.isAudio=!!c.isAudio,a=c.preMuted),d.pop(),n.streaminfo=d.join("----")}var u=v(o,b({remote:!0},s));return e.setDefaultEventsForMediaElement&&e.setDefaultEventsForMediaElement(u,o.streamid),W||o.getVideoTracks().length?void t({mediaElement:u,session:s,stream:o,preMuted:a}):u.addEventListener("play",r,!1)}},onremovestream:function(n){n&&n.streamid?(n=e.streams[n.streamid],n&&(m("on:stream:ended via on:remove:stream",n),g(n,e))):m("on:remove:stream",n)},onclose:function(t){t.extra=n.extra,t.userid=n.userid,e.onclose(t),e.channels[t.userid]&&delete e.channels[t.userid]},onerror:function(t){t.extra=n.extra,t.userid=n.userid,e.onerror(t)},oniceconnectionstatechange:function(t){m("oniceconnectionstatechange",p(t)),N.connection&&"connected"==N.connection.iceConnectionState&&"complete"==N.connection.iceGatheringState&&"stable"==N.connection.signalingState&&1==e.numberOfConnectedUsers&&e.onconnected({userid:n.userid,extra:n.extra,peer:e.peers[n.userid],targetuser:n.userinfo}),!e.isInitiator&&N.connection&&"connected"==N.connection.iceConnectionState&&"complete"==N.connection.iceGatheringState&&"stable"==N.connection.signalingState&&1==e.numberOfConnectedUsers&&e.onstatechange({userid:n.userid,extra:n.extra,name:"connected-with-initiator",reason:"ICE connection state seems connected; gathering state is completed; and signaling state is stable."}),e.peers[n.userid]&&e.peers[n.userid].oniceconnectionstatechange&&e.peers[n.userid].oniceconnectionstatechange(t),e.peers[n.userid]&&"failed"==e.peers[n.userid].peer.connection.iceConnectionState&&e.onfailed({userid:n.userid,extra:n.extra,peer:e.peers[n.userid],targetuser:n.userinfo}),e.peers[n.userid]&&"disconnected"==e.peers[n.userid].peer.connection.iceConnectionState&&(!N.connection.renegotiate&&e.ondisconnected({userid:n.userid,extra:n.extra,peer:e.peers[n.userid],targetuser:n.userinfo}),N.connection.renegotiate=!1),e.autoReDialOnFailure&&e.peers[n.userid]&&("disconnected"!=e.peers[n.userid].peer.connection.iceConnectionState&&(n.redialing=!1),"disconnected"!=e.peers[n.userid].peer.connection.iceConnectionState||n.redialing||(n.redialing=!0,f("Peer connection is closed.",p(e.peers[n.userid].peer.connection),"ReDialing.."),e.peers[n.userid].socket.send({redial:!0}),e.streams.remove({remote:!0,userid:n.userid})))},onsignalingstatechange:function(e){m("onsignalingstatechange",p(e))},attachStreams:e.dontAttachStream?[]:e.attachStreams,iceServers:e.iceServers,rtcConfiguration:e.rtcConfiguration,bandwidth:e.bandwidth,sdpConstraints:e.sdpConstraints,optionalArgument:e.optionalArgument,disableDtlsSrtp:e.disableDtlsSrtp,dataChannelDict:e.dataChannelDict,preferSCTP:e.preferSCTP,onSessionDescription:function(e,n){L({sdp:e,socket:U,streaminfo:n})},trickleIce:e.trickleIce,processSdp:e.processSdp,sendStreamId:function(e){U&&U.send({streamid:e.streamid,isScreen:!!e.isScreen,isAudio:!!e.isAudio,isVideo:!!e.isVideo})},rtcMultiConnection:e};e.playRoleOfInitiator=function(){e.dontCaptureUserMedia=!0,e.open(),K=c(K),e.dontCaptureUserMedia=!1},e.askToShareParticipants=function(){ne&&ne.send({askToShareParticipants:!0})},e.shareParticipants=function(n){var t={joinUsers:Z,userid:e.userid,extra:e.extra};n&&(n.dontShareWith&&(t.dontShareWith=n.dontShareWith),n.shareWith&&(t.shareWith=n.shareWith)),ne.send(t)}}function P(n,t){if(n)for(var i=0;i<n.length;i++){var o=n[i];e.streams[o]&&t.removeStream(e.streams[o].stream)}}function L(n){n.socket.send({sdp:JSON.stringify({sdp:n.sdp.sdp,type:n.sdp.type}),renegotiate:n.renegotiate?n.renegotiate:!1,streaminfo:n.streaminfo||"",labels:n.labels||[],preferSCTP:!!e.preferSCTP,fakeDataChannels:!!e.fakeDataChannels,isInitiator:!!e.isInitiator,userinfo:{browser:V?"firefox":"chrome"}})}function F(n){var t=n.newParticipant;if(t&&!Z[t]&&t!=e.userid){var i=e.token();E({channel:i,extra:n.userData?n.userData.extra:n.extra,userid:n.userData?n.userData.userid:n.userid}),ne.send({participant:!0,targetUser:t,channel:i})}}function _(){e.numberOfConnectedUsers--;var n={left:!0,extra:e.extra||{},userid:e.userid,sessionid:e.sessionid};e.isInitiator&&(e.autoCloseEntireSession?n.closeEntireSession=!0:K[0]&&K[0].send({playRoleOfBroadcaster:!0,userid:e.userid,extra:e.extra,participants:Z})),K.forEach(function(e,t){e.send(n),X[e.channel]&&delete X[e.channel],delete K[t]}),K=c(K),e.refresh(),N.forEach(function(e){e.disconnect()}),N=[]}function B(){$.signalingReady||($.signalingReady=!0,setTimeout(n,1e3),e.isInitiator||ne&&ne.send({searchingForRooms:!0}))}function q(n){for(var t in n)Z[n[t]]||F({sessionid:e.sessionid,newParticipant:n[t],userid:e.userid,extra:e.extra})}function z(){return e.openSignalingChannel({onmessage:function(n){if(!te&&n.userid!=e.userid){if(n.sessionid&&n.userid&&(e.sessionDescriptions[n.sessionid]||(e.numberOfSessions++,e.sessionDescriptions[n.sessionid]=n,e.isAcceptNewSession&&(e.dontOverrideSession||(e.session=n.session),M(n)))),n.newParticipant&&!e.isAcceptNewSession&&$.broadcasterid===n.userid&&n.newParticipant!=e.userid&&F(n),h(Z)<e.maxParticipantsAllowed&&n.targetUser==e.userid&&n.participant){if(e.peers[n.userid]&&!e.peers[n.userid].peer)return delete Z[n.userid],delete e.peers[n.userid],e.isAcceptNewSession=!0,Y(n);Z[n.userid]||Y(n)}if(n.acceptedRequestOf==e.userid&&e.onstatechange({userid:n.userid,extra:n.extra,name:"request-accepted",reason:n.userid+" accepted your participation request."}),n.rejectedRequestOf==e.userid&&e.onstatechange({userid:n.userid,extra:n.extra,name:"request-rejected",reason:n.userid+" rejected your participation request."}),n.customMessage)if(n.message.drop){e.ondrop(n.userid),e.attachStreams=[];for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],"local"==t.type?(e.detachStreams.push(t.streamid),g(t,e)):g(t,e));n.message.renegotiate&&e.renegotiate()}else e.onCustomMessage&&e.onCustomMessage(n.message);if(e.isInitiator&&n.searchingForRooms&&ne&&ne.send({sessionDescription:e.sessionDescription,responseFor:n.userid}),n.sessionDescription&&n.responseFor==e.userid){var i=n.sessionDescription;e.sessionDescriptions[i.sessionid]||(e.numberOfSessions++,e.sessionDescriptions[i.sessionid]=i)}e.isInitiator&&n.askToShareParticipants&&ne&&e.shareParticipants({shareWith:n.userid}),n.shareWith==e.userid&&n.dontShareWith!=e.userid&&n.joinUsers&&q(n.joinUsers),!n.shareWith&&n.joinUsers&&(n.dontShareWith?e.userid!=n.dontShareWith&&q(n.joinUsers):q(n.joinUsers)),n.messageFor==e.userid&&n.presenceState&&("checking"==n.presenceState&&(ne.send({messageFor:n.userid,presenceState:"available",_config:n._config}),m("participant asked for availability")),"available"==n.presenceState&&($.presenceState="available",e.onstatechange({userid:"browser",extra:{},name:"room-available",reason:"Initiator is available and room is active."}),J(n._config))),n.donotJoin&&n.messageFor==e.userid&&m(n.userid,"is not joining your room."),n.isDisconnectSockets&&(m("Disconnecting your sockets because initiator also disconnected his sockets."),e.disconnect())}},callback:function(e){e&&this.onopen(e)},onopen:function(n){n&&(ne=n),B&&B(),$.defaultSocket=ne,ne.__push||(ne.__push=ne.send,ne.send=function(n){n.userid=n.userid||e.userid,n.extra=n.extra||e.extra||{},ne.__push(n)})}})}function G(){var n=0;256!=e.maxParticipantsAllowed&&(n=e.maxParticipantsAllowed),"one-way"==e.direction&&(e.session.oneway=!0),"one-to-one"==e.direction&&(e.maxParticipantsAllowed=1),"one-to-many"==e.direction&&(e.session.broadcast=!0),"many-to-many"==e.direction&&(e.maxParticipantsAllowed&&1!=e.maxParticipantsAllowed||(e.maxParticipantsAllowed=256)),n&&1!=e.maxParticipantsAllowed&&(e.maxParticipantsAllowed=n)}function J(n,i){if(!$.donotJoin||$.donotJoin!=n.sessionid){e.dontOverrideSession||(e.session=n.session||{}),$.broadcasterid=n.userid,n.sessionid&&(e.sessionid=n.sessionid),e.isAcceptNewSession=!1;var o=t();E({channel:o,extra:n.extra||{},userid:n.userid});var s={};if(e.attachStreams.length){var a=e.attachStreams[e.attachStreams.length-1];a.getAudioTracks&&a.getAudioTracks().length&&(s.audio=!0),a.getVideoTracks().length&&(s.video=!0)}m(r(s)?"Seems data-only connection.":p(s)),e.onstatechange({userid:n.userid,extra:{},name:"connecting-with-initiator",reason:"Checking presence of the initiator; and the room."}),ne.send({participant:!0,channel:o,targetUser:n.userid,session:e.session,offers:{audio:!!s.audio,video:!!s.video}}),e.skipOnNewSession=!1,C(e)}}function Y(n){if($.requestsFrom||($.requestsFrom={}),!$.requestsFrom[n.userid]){var t={userid:n.userid,extra:n.extra,channel:n.channel||n.userid,session:n.session||e.session};if(n.offers){m(n.offers.audio&&n.offers.video?"target user has both audio/video streams.":n.offers.audio&&!n.offers.video?"target user has only audio stream.":!n.offers.audio&&n.offers.video?"target user has only video stream.":"target user has no stream; it seems one-way streaming or data-only connection.");var i=e.sdpConstraints.mandatory;o(i.OfferToReceiveAudio)&&(e.sdpConstraints.mandatory.OfferToReceiveAudio=!!n.offers.audio),o(i.OfferToReceiveVideo)&&(e.sdpConstraints.mandatory.OfferToReceiveVideo=!!n.offers.video),m("target user's SDP has?",p(e.sdpConstraints.mandatory))}$.requestsFrom[n.userid]=t,e.onRequest&&e.isInitiator?e.onRequest(t):Q(t)}}function Q(n){return $.captureUserMediaOnDemand?($.captureUserMediaOnDemand=!1,void e.captureUserMedia(function(){Q(n),C(e)})):(m("accepting request from",n.userid),Z[n.userid]=n.userid,void E({isofferer:!0,userid:n.userid,channel:n.channel,extra:n.extra||{},session:n.session||e.session}))}var X={},K=[],$=this,Z={};!$.fileBufferReader&&e.session.data&&e.enableFileSharing&&k(e,function(e){$.fileBufferReader=e});var ee=new I(e);e.remove=function(n){$.requestsFrom&&$.requestsFrom[n]&&delete $.requestsFrom[n],e.peers[n]&&(e.peers[n].peer&&e.peers[n].peer.connection&&("closed"!=e.peers[n].peer.connection.signalingState&&e.peers[n].peer.connection.close(),e.peers[n].peer.connection=null),delete e.peers[n]),Z[n]&&delete Z[n];for(var t in e.streams)t=e.streams[t],t.userid==n&&(g(t,e),delete e.streams[t]);X[n]&&delete X[n]},e.refresh=function(){e.isInitiator&&e.socket&&e.socket.remove&&e.socket.remove(),Z={};for(var n=0;n<e.attachStreams.length;n++)e.stopMediaStream(e.attachStreams[n]);de={streams:[],mutex:!1,queueRequests:[]},$.isOwnerLeaving=!0,e.isInitiator=!1,e.isAcceptNewSession=!0,e.attachMediaStreams=[],e.sessionDescription=null,e.sessionDescriptions={},e.localStreamids=[],e.preRecordedMedias={},e.snapshots={},e.numberOfConnectedUsers=0,e.numberOfSessions=0,e.attachStreams=[],e.detachStreams=[],e.fileQueue={},e.channels={},e.renegotiatedSessions={};for(var t in e.peers)t!=e.userid&&delete e.peers[t];for(var i in e.streams)-1==e._skip.indexOf(i)&&(g(e.streams[i],e),delete e.streams[i]);X={},K=[],Z={}},e.reject=function(n){s(n)||(n=n.userid),ne.send({rejectedRequestOf:n}),e.remove(n)},$.leaveHandler=function(n){return e.leaveOnPageUnload?o(n.keyCode)?_():void(116==n.keyCode&&_()):void 0},U("beforeunload",$.leaveHandler),U("keyup",$.leaveHandler),$.onLineOffLineHandler=function(){navigator.onLine?$.isOffLine&&($.isOffLine=!navigator.onLine):$.isOffLine=!0},U("load",$.onLineOffLineHandler),U("online",$.onLineOffLineHandler),U("offline",$.onLineOffLineHandler);var ne=z();$.defaultSocket=ne,ne&&B&&setTimeout(B,2e3),e.session.screen&&R(),e.getExternalIceServers&&x(function(n){e.iceServers=e.iceServers.concat(n)}),0==e.log&&e.skipLogs(),e.onlog&&(m=f=l=function(){var n={},t=0;Array.prototype.slice.call(arguments).forEach(function(e){n[t++]=p(e)}),p=function(e){return e},e.onlog(n)}),this.initSession=function(n){function t(){ne&&h(Z)<e.maxParticipantsAllowed&&!$.isOwnerLeaving&&ne.send(e.sessionDescription),e.transmitRoomOnce||$.isOwnerLeaving||setTimeout(t,e.interval||3e3)}$.isOwnerLeaving=!1,G(),Z={},$.isOwnerLeaving=!1,o(n.transmitRoomOnce)||(e.transmitRoomOnce=n.transmitRoomOnce),n.dontTransmit||t()},this.joinSession=function(n){function t(){ne.send({messageFor:n.userid,presenceState:$.presenceState,_config:{userid:n.userid,extra:n.extra||{},sessionid:n.sessionid,session:n.session||!1}})}function i(){"checking"==$.presenceState&&(f("Unable to reach initiator. Trying again..."),t(),setTimeout(function(){"checking"==$.presenceState&&(e.onstatechange({userid:n.userid,extra:n.extra||{},name:"room-not-available",reason:"Initiator seems absent. Waiting for someone to open the room."}),e.isAcceptNewSession=!0,setTimeout(i,2e3))},2e3))}return ne?(n=n||{},Z={},$.presenceState="checking",e.onstatechange({userid:n.userid,extra:n.extra||{},name:"detecting-room-presence",reason:"Checking presence of the room."}),t(),void setTimeout(i,3e3)):setTimeout(function(){f("Default-Socket is not yet initialized."),$.joinSession(n)},1e3)},e.donotJoin=function(n){$.donotJoin=n;var t=e.sessionDescriptions[n];t&&(ne.send({donotJoin:!0,messageFor:t.userid,sessionid:n}),Z={},e.isAcceptNewSession=!0,e.sessionid=null)},this.send=function(n,t){if(n instanceof ArrayBuffer||n instanceof DataView||(n=d({extra:e.extra,userid:e.userid,data:n})),t)return void("open"==t.readyState&&t.send(n));for(var i in e.channels){var o=e.channels[i].channel;"open"==o.readyState&&o.send(n)}},this.leave=function(){_()},this.addStream=function(n){function t(t){var o=t.socket;if(!o)return void f(t,"doesn't has socket.");if(O(o),!t||!t.peer)throw"No peer to renegotiate.";var s=t.peer;n.stream&&(s.attachStreams||(s.attachStreams=[]),s.attachStreams.push(n.stream)),P(e.detachStreams,s.connection),n.stream&&(i.audio||i.video||i.screen)&&s.addStream(n.stream),s.recreateOffer(i,function(n,t){L({sdp:n,socket:o,renegotiate:i,labels:e.detachStreams,streaminfo:t}),e.detachStreams=[]})}var i=n.renegotiate;if(e.renegotiatedSessions[JSON.stringify(n.renegotiate)]||(e.renegotiatedSessions[JSON.stringify(n.renegotiate)]={session:n.renegotiate,stream:n.stream}),n.socket)n.socket.userid!=e.userid&&t(e.peers[n.socket.userid]);else for(var o in e.peers)o!=e.userid&&t(e.peers[o])},e.request=function(n,t){e.captureUserMedia(function(){E({channel:e.userid,extra:t||{},userid:n}),ne.send({participant:!0,targetUser:n})})},e.accept=function(n){arguments.length>1&&s(arguments[0])&&(n={},arguments[0]&&(n.userid=arguments[0]),arguments[1]&&(n.extra=arguments[1]),arguments[2]&&(n.channel=arguments[2])),e.captureUserMedia(function(){Q(n)})};var te=!1;this.disconnect=function(){if(this.isOwnerLeaving=!0,!e.keepStreamsOpened){for(var n in e.localStreams)e.localStreams[n].stop();e.localStreams={},de={streams:[],mutex:!1,queueRequests:[]}}e.isInitiator&&ne.send({isDisconnectSockets:!0}),e.refresh(),$.defaultSocket=ne=null,te=!0,e.ondisconnected({userid:e.userid,extra:e.extra,peer:e.peers[e.userid],isSocketsDisconnected:!0}),e.close(),window.removeEventListener("beforeunload",$.leaveHandler),window.removeEventListener("keyup",$.leaveHandler),delete this,m("Disconnected your sockets, peers, streams and everything except RTCMultiConnection object.")}}function n(e){if(!e)throw"MediaStream is mandatory.";if(e.getVideoTracks&&!e.getVideoTracks().length)return e;var n=new AudioContext,t=n.createMediaStreamSource(e),i=n.createMediaStreamDestination();return t.connect(i),N.push(t),i.stream}function t(){if(window.crypto&&crypto.getRandomValues&&-1==navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),n="",t=0,i=e.length;i>t;t++)n+=e[t].toString(36);return n}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function i(e){return!e.audio&&!e.video&&!e.screen&&e.data}function o(e){return"undefined"==typeof e}function s(e){return"string"==typeof e}function r(e){var n=0;for(var t in e)n++;return 0==n}function a(e){var n="";try{n=String.fromCharCode.apply(null,new Uint16Array(e))}catch(t){}return n}function d(e){s(e)||(e=JSON.stringify(e));for(var n=new ArrayBuffer(2*e.length),t=new Uint16Array(n),i=0,o=e.length;o>i;i++)t[i]=e.charCodeAt(i);return n}function c(e){for(var n=[],t=e.length,i=0;t>i;i++)e[i]&&e[i]!==!0&&n.push(e[i]);return n}function u(e,n){for(var t in e)n(e[t],t)}function m(){Y.log(arguments)}function l(){Y.error(arguments)}function f(){Y.warn(arguments)}function p(e){return JSON.stringify(e,function(e,n){return n&&n.sdp?(m(n.sdp.type,"	",n.sdp.sdp),""):n},"	")}function h(e){var n=0;for(var t in e)t&&n++;return n}function v(e,n){var t=document.createElement(e.isAudio?"audio":"video");if(t.id=e.streamid,W){var i=document.body||document.documentElement;return i.insertBefore(t,i.firstChild),setTimeout(function(){oe.attachMediaStream(t,e)},1e3),oe.attachMediaStream(t,e)}return t[V?"mozSrcObject":"src"]=V?e:(window.URL||window.webkitURL).createObjectURL(e),t.controls=!0,t.autoplay=!!n.remote,t.muted=n.remote?!1:!0,V&&t.addEventListener("ended",function(){e.onended()},!1),t.play(),t}function g(e,n){(!e.mediaElement||e.mediaElement.parentNode)&&($[e.streamid]||($[e.streamid]=e,n.onstreamended(e)))}function S(e,n){Z[e.userid]||(Z[e.userid]=e,n.onleave(e))}function w(e){function n(n){var o=document.createElement("canvas");o.width=n.videoWidth||n.clientWidth,o.height=n.videoHeight||n.clientHeight;var s=o.getContext("2d");s.drawImage(n,0,0,o.width,o.height),i.snapshots[t]=o.toDataURL("image/png"),e.callback&&e.callback(i.snapshots[t])}var t=e.userid,i=e.connection;if(e.mediaElement)return n(e.mediaElement);for(var o in i.streams)o=i.streams[o],o.userid==t&&o.stream&&o.stream.getVideoTracks&&o.stream.getVideoTracks().length&&n(o.mediaElement)}function C(e){e.onMediaCaptured&&(e.onMediaCaptured(),delete e.onMediaCaptured)}function b(e,n){if(e||(e={}),!n)return e;for(var t in n)e[t]=n[t];return e}function y(e,n){var t=document.createElement("script");t.src=e,t.onload=function(){m("loaded resource:",e),n&&n()},document.documentElement.appendChild(t)}function T(e){var n=e.connection,t=e.element;if(!window.html2canvas)return y(n.resources.html2canvas,function(){T(e)});if(s(t)&&(t=document.querySelector(t),t||(t=document.getElementById(t))),!t)throw"HTML DOM Element is not accessible!";html2canvas(t,{onrendered:function(n){e.callback(n.toDataURL())}})}function k(e,n){function t(e){return e.userid=e.extra.userid,e}if(!window.FileBufferReader)return void y(e.resources.FileBufferReader,function(){k(e,n)});var i=new FileBufferReader;i.onProgress=function(n){e.onFileProgress(t(n),n.uuid)},i.onBegin=function(n){e.onFileStart(t(n))},i.onEnd=function(n){e.onFileEnd(t(n))},n(i)}function R(e){if(DetectRTC.screen.extensionid==te&&!X){if(!e)return R(!0);X=!0;var n=document.createElement("iframe");n.onload=function(){n.isLoaded=!0,m("Screen Capturing frame is loaded.")},n.src="https://www.webrtc-experiment.com/getSourceId/",n.style.display="none",(document.body||document.documentElement).appendChild(n),Q={postMessage:function(){return n.isLoaded?void n.contentWindow.postMessage({
captureSourceId:!0},"*"):void setTimeout(Q.postMessage,100)}}}}function x(e,n){if(!K){if(!n)return x(e,!0);K=!0;var t=document.createElement("iframe");t.onload=function(){function n(t){t.data&&t.data.iceServers&&(e(t.data.iceServers),window.removeEventListener("message",n))}t.isLoaded=!0,U("message",n),t.contentWindow.postMessage("get-ice-servers","*")},t.src="https://cdn.webrtc-experiment.com/getIceServers/",t.style.display="none",(document.body||document.documentElement).appendChild(t)}}function M(e){var n=e.stream,t=e.root,i=e.session||{},o=e.enabled;if(i.audio||i.video||(i=s(i)?{audio:!0,video:!0}:b(i,{audio:!0,video:!0})),i.type){if("remote"==i.type&&"remote"!=t.type)return;if("local"==i.type&&"local"!=t.type)return}if(m(o?"Muting":"UnMuting","session",p(i)),"local"==t.type&&i.audio&&n.getAudioTracks){var r=n.getAudioTracks()[0];r&&(r.enabled=!o)}if("local"==t.type&&(i.video||i.screen)&&n.getVideoTracks){var a=n.getVideoTracks()[0];a&&(a.enabled=!o)}if(t.sockets.forEach(function(e){"local"==t.type&&e.send({streamid:t.streamid,mute:!!o,unmute:!o,session:i}),"remote"==t.type&&e.send({promptMuteUnmute:!0,streamid:t.streamid,mute:!!o,unmute:!o,session:i})}),"remote"!=t.type){var d=b({},t);d.session=i,d.isAudio=!!d.session.audio&&!d.session.video,d.isVideo=!!d.session.video,d.isScreen=!!d.session.screen,o&&(n.preMuted={audio:n.getAudioTracks().length&&!n.getAudioTracks()[0].enabled,video:n.getVideoTracks().length&&!n.getVideoTracks()[0].enabled},t.rtcMultiConnection.onmute(d)),o||(n.preMuted={},t.rtcMultiConnection.onunmute(d))}}function D(e){if(!window.hark)return void y(e.connection.resources.hark,function(){D(e)});var n=e.connection,t=e.streamedObject,i=e.stream,o={},s=hark(i,o);s.on("speaking",function(){n.onspeaking&&n.onspeaking(t)}),s.on("stopped_speaking",function(){n.onsilence&&n.onsilence(t)}),s.on("volume_change",function(e,i){n.onvolumechange&&n.onvolumechange(b({volume:e,threshold:i},t))})}function O(e){function n(n,o,s){s||(s=t()),i.localStreams[s]=n;var r=e.video;r&&(r[V?"mozSrcObject":"src"]=V?n:(window.URL||window.webkitURL).createObjectURL(n),r.play()),e.onsuccess(n,o,w,s),de.streams[w]={stream:n,streamid:s},de.mutex=!1,de.queueRequests.length&&O(de.queueRequests.shift())}if(W)return oe.getUserMedia?oe.getUserMedia(e.constraints||{audio:!0,video:!0},e.onsuccess,e.onerror):void setTimeout(function(){O(e)},1e3);if(de.mutex===!0)return void de.queueRequests.push(e);de.mutex=!0;var i=e.connection,o=e.mediaConstraints||{},s="boolean"==typeof o.video?o.video:o.video||o,a="boolean"==typeof o.audio?o.audio:o.audio||ae,d=navigator,u=e.constraints||{audio:ae,video:ae};u.video&&u.video.mozMediaSource&&(s={}),1==u.video&&(u.video=ae),1==u.audio&&(u.audio=ae),"boolean"==typeof a&&u.audio&&(u.audio=a),"boolean"==typeof s&&u.video&&(u.video=s);var h=a.mandatory;r(h)||(u.audio.mandatory=b(u.audio.mandatory,h));var v=s.mandatory;if(v){var g={};if(v.minWidth&&(g.minWidth=v.minWidth),v.minHeight&&(g.minHeight=v.minHeight),v.maxWidth&&(g.maxWidth=v.maxWidth),v.maxHeight&&(g.maxHeight=v.maxHeight),v.minAspectRatio&&(g.minAspectRatio=v.minAspectRatio),v.maxFrameRate&&(g.maxFrameRate=v.maxFrameRate),v.minFrameRate&&(g.minFrameRate=v.minFrameRate),g.minWidth&&g.minHeight){var S=["1920:1080","1280:720","960:720","640:360","640:480","320:240","320:180"];(-1==S.indexOf(g.minWidth+":"+g.minHeight)||-1==S.indexOf(g.maxWidth+":"+g.maxHeight))&&l('The min/max width/height constraints you passed "seems" NOT supported.',p(g)),(g.minWidth>g.maxWidth||g.minHeight>g.maxHeight)&&l("Minimum value must not exceed maximum value.",p(g)),g.minWidth>=1280&&g.minHeight>=720&&f("Enjoy HD video! min/"+g.minWidth+":"+g.minHeight+", max/"+g.maxWidth+":"+g.maxHeight)}u.video.mandatory=b(u.video.mandatory,g)}v&&(u.video.mandatory=b(u.video.mandatory,v)),s.optional&&s.optional instanceof Array&&s.optional.length&&(u.video.optional=u.video.optional?u.video.optional.concat(s.optional):s.optional),a.optional&&a.optional instanceof Array&&a.optional.length&&(u.audio.optional=u.audio.optional?u.audio.optional.concat(a.optional):a.optional),u.video.mandatory&&!r(u.video.mandatory)&&i._mediaSources.video&&(u.video.optional.forEach(function(e,n){e.sourceId==i._mediaSources.video&&delete u.video.optional[n]}),u.video.optional=c(u.video.optional),u.video.optional.push({sourceId:i._mediaSources.video})),u.audio.mandatory&&!r(u.audio.mandatory)&&i._mediaSources.audio&&(u.audio.optional.forEach(function(e,n){e.sourceId==i._mediaSources.audio&&delete u.audio.optional[n]}),u.audio.optional=c(u.audio.optional),u.audio.optional.push({sourceId:i._mediaSources.audio})),u.video&&!u.video.mozMediaSource&&u.video.optional&&u.video.mandatory&&!u.video.optional.length&&r(u.video.mandatory)&&(u.video=!0),H&&(u={audio:!!u.audio,video:!!u.video}),m("invoked getUserMedia with constraints:",p(u));var w=JSON.stringify(u);de.streams[w]?n(de.streams[w].stream,!0,de.streams[w].streamid):(d.getMedia=d.webkitGetUserMedia||d.mozGetUserMedia,d.getMedia(u,n,function(n){e.onerror(n,u)}))}function E(e){var n,t={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo};return n={mandatory:t,optional:[{VoiceActivityDetection:!1}]},navigator.mozGetUserMedia&&J>34&&(n={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}),n}function A(){return{create:function(e,n){b(this,n);var t=this;return this.type=e,this.init(),this.attachMediaStreams(),V&&this.session.data?(this.session.data&&"offer"==e&&this.createDataChannel(),this.getLocalDescription(e),this.session.data&&"answer"==e&&this.createDataChannel()):t.getLocalDescription(e),this},getLocalDescription:function(e){function n(){t.connection["offer"==e?"createOffer":"createAnswer"](function(n){n.sdp=t.serializeSdp(n.sdp,e),t.connection.setLocalDescription(n),t.trickleIce&&t.onSessionDescription(n,t.streaminfo),"offer"==n.type&&m("offer sdp",n.sdp),t.prevCreateType=e},t.onSdpError,t.constraints)}m("(getLocalDescription) peer createType is",e),this.session.inactive&&o(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing)&&(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing=!1);var t=this;"answer"==e?this.setRemoteDescription(this.offerDescription,n):n()},serializeSdp:function(e,n){if(e=this.processSdp(e),V)return e;if(this.session.inactive&&!this.holdMLine&&(this.hold=!0,(this.session.screen||this.session.video)&&this.session.audio?this.holdMLine="both":this.session.screen||this.session.video?this.holdMLine="video":this.session.audio&&(this.holdMLine="audio")),e=this.setBandwidth(e),"both"==this.holdMLine){if(this.hold)this.prevSDP=e,e=e.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive");else if(this.prevSDP&&!this.session.inactive&&(e=this.prevSDP,35>=z))return e}else if("audio"==this.holdMLine||"video"==this.holdMLine){e=e.split("m=");var t="",i="";e[1]&&0==e[1].indexOf("audio")&&(t="m="+e[1]),e[2]&&0==e[2].indexOf("audio")&&(t="m="+e[2]),e[1]&&0==e[1].indexOf("video")&&(i="m="+e[1]),e[2]&&0==e[2].indexOf("video")&&(i="m="+e[2]),"audio"==this.holdMLine&&(this.hold?(this.prevSDP=e[0]+t+i,e=e[0]+t.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")+i):this.prevSDP&&(e=this.prevSDP)),"video"==this.holdMLine&&(this.hold?(this.prevSDP=e[0]+t+i,e=e[0]+t+i.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")):this.prevSDP&&(e=this.prevSDP))}return!this.hold&&this.session.inactive&&(e="offer"==n?e.replace(/a=setup:passive|a=setup:active|a=setup:holdconn/g,"a=setup:actpass"):e.replace(/a=setup:actpass|a=setup:passive|a=setup:holdconn/g,"a=setup:active"),e=e.replace(/a=inactive/g,"a=sendrecv")),e},init:function(){function e(){return n.returnedSDP?void(n.returnedSDP=!1):(n.returnedSDP=!0,void n.onSessionDescription(n.connection.localDescription,n.streaminfo))}this.setConstraints(),this.connection=new re(this.iceServers,this.optionalArgument),this.session.data&&(m("invoked: createDataChannel"),this.createDataChannel()),this.connection.onicecandidate=function(t){return t.candidate?void(n.trickleIce&&n.onicecandidate(t.candidate)):void(n.trickleIce||e())},this.connection.onaddstream=function(e){m("onaddstream",W?e.stream:p(e.stream)),n.onaddstream(e.stream,n.session)},this.connection.onremovestream=function(e){n.onremovestream(e.stream)},this.connection.onsignalingstatechange=function(){n.connection&&n.oniceconnectionstatechange({iceConnectionState:n.connection.iceConnectionState,iceGatheringState:n.connection.iceGatheringState,signalingState:n.connection.signalingState})},this.connection.oniceconnectionstatechange=function(){n.connection&&(n.oniceconnectionstatechange({iceConnectionState:n.connection.iceConnectionState,iceGatheringState:n.connection.iceGatheringState,signalingState:n.connection.signalingState}),n.trickleIce||"complete"==n.connection.iceGatheringState&&(m("iceGatheringState",n.connection.iceGatheringState),e()))};var n=this},setBandwidth:function(e){if(H||V||!this.bandwidth)return e;var n=this.bandwidth;return this.session.screen&&(n.screen?n.screen<300&&f("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):f("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),n.screen&&this.session.screen&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n")),(n.audio||n.video||n.data)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),n.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+n.audio+"\r\n")),n.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(this.session.screen?n.screen:n.video)+"\r\n")),n.data&&!this.preferSCTP&&(e=e.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+n.data+"\r\n")),e},setConstraints:function(){var e=E({OfferToReceiveAudio:!!this.session.audio,OfferToReceiveVideo:!!this.session.video||!!this.session.screen});if(this.sdpConstraints.mandatory&&(e=E(this.sdpConstraints.mandatory)),this.constraints=e,this.constraints&&m("sdp-constraints",p(this.constraints)),this.optionalArgument={optional:this.optionalArgument.optional||[],mandatory:this.optionalArgument.mandatory||{}},this.preferSCTP||this.optionalArgument.optional.push({RtpDataChannels:!0}),m("optional-argument",p(this.optionalArgument)),o(this.iceServers))this.iceServers=null;else{var n=this.rtcMultiConnection.candidates,t=n.stun,i=n.turn,s=n.host;o(n.reflexive)||(t=n.reflexive),o(n.relay)||(i=n.relay),s||t||!i?s||t||i||(this.rtcConfiguration.iceTransports="none"):this.rtcConfiguration.iceTransports="relay",this.iceServers={iceServers:this.iceServers,iceTransports:this.rtcConfiguration.iceTransports}}m("rtc-configuration",p(this.iceServers))},onSdpError:function(e){var n=p(e);n&&-1!=n.indexOf("RTP/SAVPF Expects at least 4 fields")&&(n="It seems that you are trying to interop RTP-datachannels with SCTP. It is not supported!"),l("onSdpError:",n)},onSdpSuccess:function(){m("sdp success")},onMediaError:function(e){l(p(e))},setRemoteDescription:function(e,n){if(!e)throw"Remote session description should NOT be NULL.";if(this.connection){m("setting remote description",e.type,e.sdp);var t=this;this.connection.setRemoteDescription(new ce(e),n||this.onSdpSuccess,function(e){-1==e.search(/STATE_SENTINITIATE|STATE_INPROGRESS/gi)&&t.onSdpError(e)})}},addIceCandidate:function(e){function n(n){t.connection.addIceCandidate(n,function(){m("added:",e.sdpMid,e.candidate)},function(){l("onIceFailure",arguments,e.candidate)})}var t=this;W?ue(e,function(e){n(e)}):n(new ue(e))},createDataChannel:function(e){if(!this.channels||!this.channels.length){var n=this;this.channels||(this.channels=[]);var t={};this.dataChannelDict&&(t=this.dataChannelDict),B&&!this.preferSCTP&&(t.reliable=!1),m("dataChannelDict",p(t)),("answer"==this.type||V)&&(this.connection.ondatachannel=function(e){n.setChannelEvents(e.channel)}),(B&&"offer"==this.type||V)&&this.setChannelEvents(this.connection.createDataChannel(e||"channel",t))}},setChannelEvents:function(e){var n=this;e.binaryType="arraybuffer",this.dataChannelDict.binaryType&&(e.binaryType=this.dataChannelDict.binaryType),e.onmessage=function(e){n.onmessage(e.data)};var t=0;e.onopen=function(){e.push=e.send,e.send=function(i){if("disconnected"!=n.connection.iceConnectionState&&-1==e.readyState.search(/closing|closed/g)&&-1!=e.readyState.search(/connecting|open/g)){if("connecting"==e.readyState)return t++,setTimeout(function(){if(!(20>t))throw"Number of times exceeded to wait for WebRTC data connection to be opened.";e.send(i)},1e3);try{e.push(i)}catch(o){if(t++,f("Data transmission failed. Re-transmitting..",t,p(o)),t>=20)throw"Number of times exceeded to resend data packets over WebRTC data channels.";setTimeout(function(){e.send(i)},100)}}},n.onopen(e)},e.onerror=function(e){n.onerror(e)},e.onclose=function(e){n.onclose(e)},this.channels.push(e)},addStream:function(e){e.streamid||j||(e.streamid=t()),m("attaching stream:",e.streamid,W?e:p(e)),this.connection.addStream(e),this.sendStreamId(e),this.getStreamInfo()},attachMediaStreams:function(){for(var e=this.attachStreams,n=0;n<e.length;n++)this.addStream(e[n])},getStreamInfo:function(){this.streaminfo="";for(var e=this.connection.getLocalStreams(),n=0;n<e.length;n++)0==n?this.streaminfo=JSON.stringify({streamid:e[n].streamid||"",isScreen:!!e[n].isScreen,isAudio:!!e[n].isAudio,isVideo:!!e[n].isVideo,preMuted:e[n].preMuted||{}}):this.streaminfo+="----"+JSON.stringify({streamid:e[n].streamid||"",isScreen:!!e[n].isScreen,isAudio:!!e[n].isAudio,isVideo:!!e[n].isVideo,preMuted:e[n].preMuted||{}})},recreateOffer:function(e,n){m("recreating offer"),this.type="offer",this.session=e,this.onSessionDescription=n,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("offer")},recreateAnswer:function(e,n,t){m("recreating answer"),this.type="answer",this.session=n,this.onSessionDescription=t,this.offerDescription=e,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("answer")}}}function P(e,n){var t=document.createElement("a");t.href=e,t.target="_blank",t.download=n||e,navigator.mozGetUserMedia&&(t.onclick=function(){(document.body||document.documentElement).removeChild(t)},(document.body||document.documentElement).appendChild(t));var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t.dispatchEvent(i),navigator.mozGetUserMedia||URL.revokeObjectURL(t.href)}function I(e){function n(n,i,o){var s=n.uuid;if(t[s]||(t[s]=[]),t[s].push(n.message),n.last){var r=t[s].join("");n.isobject&&(r=JSON.parse(r));var a=(new Date).getTime(),d=a-n.sendingTime,c={data:r,userid:i,extra:o,latency:d};r.preRecordedMediaChunk?(e.preRecordedMedias[r.streamerid]||e.shareMediaFile(null,null,r.streamerid),e.preRecordedMedias[r.streamerid].onData(r.chunk)):e.autoTranslateText?(c.original=c.data,e.Translator.TranslateText(c.data,function(n){c.data=n,e.onmessage(c)})):r.isPartOfScreen?e.onpartofscreen(r):e.onmessage(c),delete t[s]}}var t={};return{receive:n}}function U(e,n){window.removeEventListener(e,n),window.addEventListener(e,n,!1)}function L(e){function i(e,n){if(-1!=e.position){var t=+e.position.toFixed(2).split(".")[1]||100;n.innerHTML=t+"%"}}e.userid=t(),e.session={audio:!0,video:!0},e.maxParticipantsAllowed=256,e.direction="many-to-many",e.mediaConstraints={mandatory:{},optional:[],audio:{mandatory:{},optional:[]},video:{mandatory:{},optional:[]}},e.candidates={host:!0,stun:!0,turn:!0},e.sdpConstraints={},e.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},e.privileges={canStopRemoteStream:!1,canMuteRemoteStream:!1},e.iceProtocols={tcp:!0,udp:!0},e.preferSCTP=V||z>=32?!0:!1,e.chunkInterval=V||z>=32?100:500,e.chunkSize=V||z>=32?13e3:1e3,e.fakeDataChannels=!1,e.waitUntilRemoteStreamStartsFlowing=null,e.leaveOnPageUnload=!0,e.getExternalIceServers=B,e.UA={isFirefox:V,isChrome:B,isMobileDevice:H,version:B?z:J,isNodeWebkit:q,isSafari:_,isIE:j,isOpera:F},e.fileQueue={},e.renegotiatedSessions={},e.channels={},e.extra={},e.bandwidth={screen:300},e.caniuse={RTCPeerConnection:DetectRTC.isWebRTCSupported,getUserMedia:!!navigator.webkitGetUserMedia||!!navigator.mozGetUserMedia,AudioContext:DetectRTC.isAudioContextSupported,ScreenSharing:DetectRTC.isScreenCapturingSupported,RtpDataChannels:DetectRTC.isRtpDataChannelsSupported,SctpDataChannels:DetectRTC.isSctpDataChannelsSupported},e.snapshots={},e._mediaSources={},e.devices={},e.language="en",e.autoTranslateText=!1,e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.localStreamids=[],e.localStreams={},e.preRecordedMedias={},e.attachStreams=[],e.detachStreams=[],e.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300}],mandatory:{}},e.dataChannelDict={},e.dontAttachStream=!1,e.dontCaptureUserMedia=!1,e.preventSSLAutoAllowed=!1,e.autoReDialOnFailure=!0,e.isInitiator=!1,e.DetectRTC=DetectRTC,e.trickleIce=!0,e.sessionDescriptions={},e.sessionDescription=null,e.resources={RecordRTC:"https://cdn.webrtc-experiment.com/RecordRTC.js",PreRecordedMediaStreamer:"https://cdn.webrtc-experiment.com/PreRecordedMediaStreamer.js",customGetUserMediaBar:"https://cdn.webrtc-experiment.com/navigator.customGetUserMediaBar.js",html2canvas:"https://cdn.webrtc-experiment.com/screenshot.js",hark:"https://cdn.webrtc-experiment.com/hark.js",firebase:"https://cdn.webrtc-experiment.com/firebase.js",firebaseio:"https://webrtc-experiment.firebaseIO.com/",muted:"https://cdn.webrtc-experiment.com/images/muted.png",getConnectionStats:"https://cdn.webrtc-experiment.com/getConnectionStats.js",FileBufferReader:"https://cdn.webrtc-experiment.com/FileBufferReader.js"},e.body=document.body||document.documentElement,e.peers={},e.firebase="chat",e.numberOfSessions=0,e.numberOfConnectedUsers=0,e.enableFileSharing=!0,e.autoSaveToDisk=!1,e.processSdp=function(e){return e},e.onmessage=function(e){m("onmessage",p(e))},e.onopen=function(e){m("Data connection is opened between you and",e.userid)},e.onerror=function(e){l(onerror,p(e))},e.onclose=function(n){f("onclose",p(n)),e.streams.remove({userid:n.userid})};var a={};e.onFileStart=function(n){var t=document.createElement("div");t.title=n.name,t.innerHTML="<label>0%</label> <progress></progress>",e.body.insertBefore(t,e.body.firstChild),a[n.uuid]={div:t,progress:t.querySelector("progress"),label:t.querySelector("label")},a[n.uuid].progress.max=n.maxChunks},e.onFileProgress=function(e){var n=a[e.uuid];n&&(n.progress.value=e.currentPosition||e.maxChunks||n.progress.max,i(n.progress,n.label))},e.onFileEnd=function(n){a[n.uuid]&&(a[n.uuid].div.innerHTML='<a href="'+n.url+'" target="_blank" download="'+n.name+'">'+n.name+"</a>"),(e.onFileSent||e.onFileReceived)&&(e.onFileSent&&e.onFileSent(n,n.uuid),e.onFileReceived&&e.onFileReceived(n.name,n))},e.onstream=function(n){e.body.insertBefore(n.mediaElement,e.body.firstChild)},e.onstreamended=function(e){if(m("onStreamEndedHandler:",e),!e.mediaElement)return f("Event.mediaElement is undefined",e);if(!e.mediaElement.parentNode){if(e.mediaElement=document.getElementById(e.streamid),!e.mediaElement)return f("Event.mediaElement is undefined",e);if(!e.mediaElement.parentNode)return f("Event.mediElement.parentNode is null.",e)}e.mediaElement.parentNode.removeChild(e.mediaElement)},e.onSessionClosed=function(e){e.isEjected?f(e.userid,"ejected you."):f("Session has been closed.",e)},e.onmute=function(n){n.isVideo&&n.mediaElement&&(n.mediaElement.pause(),n.mediaElement.setAttribute("poster",n.snapshot||e.resources.muted)),n.isAudio&&n.mediaElement&&(n.mediaElement.muted=!0)},e.onunmute=function(e){e.isVideo&&e.mediaElement&&(e.mediaElement.play(),e.mediaElement.removeAttribute("poster")),e.isAudio&&e.mediaElement&&(e.mediaElement.muted=!1)},e.onleave=function(e){m("onleave",p(e))},e.token=t,e.peers[e.userid]={drop:function(){e.drop()},renegotiate:function(){},addStream:function(){},hold:function(){},unhold:function(){},changeBandwidth:function(){},sharePartOfScreen:function(){}},e._skip=["stop","mute","unmute","_private","_selectStreams","selectFirst","selectAll","remove"],e.streams={mute:function(e){this._private(e,!0)},unmute:function(e){this._private(e,!1)},_private:function(n,t){function i(e,n,t){n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||(!n.isScreen||e.isScreen)&&(!n.isAudio||e.isAudio)&&(!n.isVideo||e.isVideo)&&(t?e.mute(n):e.unmute(n))}if(!n||s(n))for(var o in this)-1==e._skip.indexOf(o)&&this[o]._private(n,t);else for(var o in this)-1==e._skip.indexOf(o)&&i(this[o],n,t)},stop:function(n){function t(e,n){n.userid&&e.userid!=n.userid||n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||(n.screen&&e.isScreen&&e.stop(),n.audio&&e.isAudio&&e.stop(),n.video&&e.isVideo&&e.stop(),n.audio||n.video||n.screen||e.stop())}var i;for(var o in this)if(-1==e._skip.indexOf(o))if(i=this[o],n)if(s(n)){var r={};r[n]=!0,t(i,r)}else t(i,n);else i.stop()},remove:function(n){function t(e,n){n.userid&&e.userid!=n.userid||n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||(n.screen&&e.isScreen&&i(e),n.audio&&e.isAudio&&i(e),n.video&&e.isVideo&&i(e),n.audio||n.video||n.screen||i(e))}function i(n){g(n,e),delete e.streams[n.streamid]}var o;for(var r in this)if(-1==e._skip.indexOf(r))if(o=this[r],n)if(s(n)){var a={};a[n]=!0,t(o,a)}else t(o,n);else t(o,{local:!0,remote:!0})},selectFirst:function(e){return this._selectStreams(e,!1)},selectAll:function(e){return this._selectStreams(e,!0)},_selectStreams:function(n,t){if(!n||s(n)||r(n))throw"Invalid arguments.";o(n.local)&&o(n.remote)&&o(n.userid)&&(n.local=n.remote=!0),n.isAudio||n.isVideo||n.isScreen||(n.isAudio=n.isVideo=n.isScreen=!0);var i=[];for(var a in this)-1==e._skip.indexOf(a)&&(a=this[a])&&(n.local&&"local"==a.type||n.remote&&"remote"==a.type||n.userid&&a.userid==n.userid)&&(n.isVideo&&a.isVideo&&i.push(a),n.isAudio&&a.isAudio&&i.push(a),n.isScreen&&a.isScreen&&i.push(a));return t?i:i[0]}};var d=[];d.push({url:"stun:stun.l.google.com:19302"}),d.push({url:"stun:stun.anyfirewall.com:3478"}),d.push({url:"turn:turn.bistri.com:80",credential:"homeo",username:"homeo"}),d.push({url:"turn:turn.anyfirewall.com:443?transport=tcp",credential:"webrtc",username:"webrtc"}),e.iceServers=d,e.rtcConfiguration={iceServers:null,iceTransports:"all",peerIdentity:!1},e.media={min:function(n,t){e.mediaConstraints.video&&(e.mediaConstraints.video.mandatory||(e.mediaConstraints.video.mandatory={}),e.mediaConstraints.video.mandatory.minWidth=n,e.mediaConstraints.video.mandatory.minHeight=t)},max:function(n,t){e.mediaConstraints.video&&(e.mediaConstraints.video.mandatory||(e.mediaConstraints.video.mandatory={}),e.mediaConstraints.video.mandatory.maxWidth=n,e.mediaConstraints.video.mandatory.maxHeight=t)}},e._getStream=function(n){function t(e,n,t){if(t){var i=t.onpause,o=t.onplay;t.onpause=t.onplay=function(){},n?t.pause():t.play(),t.onpause=i,t.onplay=o}}var i=b({sockets:n.socket?[n.socket]:[]},n);return i.stop=function(){var e=this;if(e.sockets.forEach(function(n){"local"==e.type&&n.send({streamid:e.streamid,stopped:!0}),"remote"==e.type&&n.send({promptStreamStop:!0,streamid:e.streamid})}),"remote"!=e.type){var n=e.stream;n&&e.rtcMultiConnection.stopMediaStream(n)}},i.mute=function(e){this.muted=!0,this._private(e,!0)},i.unmute=function(e){this.muted=!1,this._private(e,!1)},i._private=function(e,n){return e&&!o(e.sync)&&0==e.sync?void t(e,n,this.mediaElement):void M({root:this,session:e,enabled:n,stream:this.stream})},i.startRecording=function(n){var t=this;return n||(n={audio:!0,video:!0}),s(n)&&(n={audio:"audio"==n,video:"video"==n}),window.RecordRTC?(m("started recording session",n),t.videoRecorder=t.audioRecorder=null,V?t.stream.getAudioTracks().length&&t.stream.getVideoTracks().length?t.videoRecorder=RecordRTC(t.stream,{type:"video"}):n.video?t.videoRecorder=RecordRTC(t.stream,{type:"video"}):n.audio&&(t.audioRecorder=RecordRTC(t.stream,{type:"audio"})):B&&(isMediaRecorderCompatible()&&e.DetectRTC.browser.version>=50&&t.stream.getAudioTracks().length&&t.stream.getVideoTracks().length?t.videoRecorder=RecordRTC(t.stream,{type:"video"}):isMediaRecorderCompatible()&&e.DetectRTC.browser.version>=50?n.video?t.videoRecorder=RecordRTC(t.stream,{type:"video"}):n.audio&&(t.audioRecorder=RecordRTC(t.stream,{type:"audio"})):(n.video&&(t.videoRecorder=RecordRTC(t.stream,{type:"video"})),n.audio&&(t.audioRecorder=RecordRTC(t.stream,{type:"audio"})))),t.audioRecorder&&t.audioRecorder.startRecording(),void(t.videoRecorder&&t.videoRecorder.startRecording())):y(t.rtcMultiConnection.resources.RecordRTC,function(){t.startRecording(n)})},i.stopRecording=function(e,n){n||(n={audio:!0,video:!0}),s(n)&&(n={audio:"audio"==n,video:"video"==n}),m("stopped recording session",n);var t=this;n.audio&&t.audioRecorder?t.audioRecorder.stopRecording(function(){n.video&&t.videoRecorder?t.videoRecorder.stopRecording(function(){e({audio:t.audioRecorder.getBlob(),video:t.videoRecorder.getBlob()})}):e({audio:t.audioRecorder.getBlob()})}):n.video&&t.videoRecorder&&t.videoRecorder.stopRecording(function(){e({video:t.videoRecorder.getBlob()})})},i.takeSnapshot=function(n){w({mediaElement:this.mediaElement,userid:this.userid,connection:e,callback:n})},i.streamObject=i,i},e.set=function(e){for(var n in e)this[n]=e[n];return this},e.onMediaError=function(e){l("name",e.name),l("constraintName",p(e.constraintName)),l("message",e.message),l("original session",e.session)},e.takeSnapshot=function(n,t){w({userid:n,connection:e,callback:t})},e.saveToDisk=function(e,n){e.size&&e.type?me.SaveToDisk(URL.createObjectURL(e),n||e.name||e.type.replace("/","-")+e.type.split("/")[1]):me.SaveToDisk(e,n)},e.selectDevices=function(n,t){function i(n){n&&(e._mediaSources[n.kind]=n.id)}n&&i(this.devices[n]),t&&i(this.devices[t])},e.getDevices=function(n){return DetectRTC.MediaDevices.length?(DetectRTC.MediaDevices.forEach(function(n){e.devices[n.deviceId]=n}),void(n&&n(e.devices))):setTimeout(function(){e.getDevices(n)},1e3)},e.getMediaDevices=e.enumerateDevices=function(n){if(!n)throw"callback is mandatory.";e.getDevices(function(){n(e.DetectRTC.MediaDevices)})},e.onCustomMessage=function(e){m("Custom message",e)},e.ondrop=function(e){m("Media connection is dropped by "+e)},e.drop=function(n){n=n||{},e.attachStreams=[];for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],"local"==t.type?(e.detachStreams.push(t.streamid),g(t,e)):g(t,e));e.sendCustomMessage({drop:!0,dontRenegotiate:o(n.renegotiate)?!0:n.renegotiate})},e.Translator={TranslateText:function(n,t){var i=document.createElement("script");i.type="text/javascript";var o=encodeURIComponent(n),s="method"+e.token();window[s]=function(e){e.data&&e.data.translations[0]&&t&&t(e.data.translations[0].translatedText),e.error&&"Daily Limit Exceeded"==e.error.message&&(f('Text translation failed. Error message: "Daily Limit Exceeded."'),t(n))};var r="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+s+"&q="+o;i.src=r,document.getElementsByTagName("head")[0].appendChild(i)}},e.setDefaultEventsForMediaElement=function(n,t){n.onpause=function(){e.streams[t]&&!e.streams[t].muted&&e.streams[t].mute()},n.onplay=function(){e.streams[t]&&e.streams[t].muted&&e.streams[t].unmute()};var i=!1;n.onvolumechange=function(){i||(i=!0,e.streams[t]&&setTimeout(function(){var o=e.streams[t];e.streams[t].sockets.forEach(function(e){e.send({streamid:o.streamid,isVolumeChanged:!0,volume:n.volume})}),i=!1},2e3))}},e.onMediaFile=function(n){m("onMediaFile",n),e.body.appendChild(n.mediaElement)},e.shareMediaFile=function(n,t,i){return i=i||e.token(),PreRecordedMediaStreamer?PreRecordedMediaStreamer.shareMediaFile({file:n,video:t,streamerid:i,connection:e}):(y(e.resources.PreRecordedMediaStreamer,function(){e.shareMediaFile(n,t,i)}),i)},e.onpartofscreen=function(n){var t=document.createElement("img");t.src=n.screenshot,e.body.appendChild(t)},e.skipLogs=function(){m=l=f=function(){}},e.hold=function(n){for(var t in e.peers)e.peers[t].hold(n)},e.onhold=function(n){m("onhold",n),"audio"!=n.kind&&(n.mediaElement.pause(),n.mediaElement.setAttribute("poster",n.screenshot||e.resources.muted)),"audio"==n.kind&&(n.mediaElement.muted=!0)},e.unhold=function(n){for(var t in e.peers)e.peers[t].unhold(n)},e.onunhold=function(e){m("onunhold",e),"audio"!=e.kind&&(e.mediaElement.play(),e.mediaElement.removeAttribute("poster")),"audio"!=e.kind&&(e.mediaElement.muted=!1)},e.sharePartOfScreen=function(n){function t(){(!e.partOfScreen||e.partOfScreen.sharing)&&T({element:n.element,connection:e,callback:function(o){if(o!=i){i=o;for(var s in e.channels)e.channels[s].send({screenshot:o,isPartOfScreen:!0})}!n.once&&setTimeout(t,n.interval||200)}})}var i="";t(),e.partOfScreen=b({sharing:!0},n)},e.pausePartOfScreenSharing=function(){for(var n in e.peers)e.peers[n].pausePartOfScreenSharing=!0;e.partOfScreen&&(e.partOfScreen.sharing=!1)},e.resumePartOfScreenSharing=function(){for(var n in e.peers)e.peers[n].pausePartOfScreenSharing=!1;e.partOfScreen&&(e.partOfScreen.sharing=!0)},e.stopPartOfScreenSharing=function(){for(var n in e.peers)e.peers[n].stopPartOfScreenSharing=!0;e.partOfScreen&&(e.partOfScreen.sharing=!1)},e.takeScreenshot=function(n,t){if(!n||!t)throw"Invalid number of arguments.";if(!window.html2canvas)return y(e.resources.html2canvas,function(){e.takeScreenshot(n)});if(s(n)&&(n=document.querySelector(n),n||(n=document.getElementById(n))),!n)throw"HTML Element is inaccessible!";html2canvas(n,{onrendered:function(e){t(e.toDataURL())}})},e.onScreenCapturingExtensionAvailable=function(){m("It seems that screen capturing extension is installed and available on your system!")},!W&&DetectRTC.screen.onScreenCapturingExtensionAvailable&&(DetectRTC.screen.onScreenCapturingExtensionAvailable=function(){e.onScreenCapturingExtensionAvailable()}),e.changeBandwidth=function(n){for(var t in e.peers)e.peers[t].changeBandwidth(n)},e.convertToAudioStream=function(e){n(e)},e.onstatechange=function(e){m("on:state:change ("+e.userid+"):",e.name+":",e.reason||"")},e.onfailed=function(e){e.peer.numOfRetries||(e.peer.numOfRetries=0),e.peer.numOfRetries++,l("ICE connectivity check is failed. Renegotiating peer connection."),e.peer.numOfRetries<2&&e.peer.renegotiate(),e.peer.numOfRetries>=2&&(e.peer.numOfRetries=0)},e.onconnected=function(e){m("Peer connection has been established between you and",e.userid)},e.ondisconnected=function(n){l("Peer connection seems has been disconnected between you and",n.userid),r(e.channels)||e.channels[n.userid]&&(e.channels[n.userid].send({checkingPresence:!0}),setTimeout(function(){return e.peers[n.userid].connected?void delete e.peers[n.userid].connected:(e.streams.remove({remote:!0,userid:n.userid}),void e.remove(n.userid))},3e3))},e.onstreamid=function(e){m("got remote streamid",e.streamid,"from",e.userid)},e.stopMediaStream=function(n){if(!n)throw"MediaStream argument is mandatory.";if(e.keepStreamsOpened)return void(n.onended&&n.onended());e.localStreams[n.streamid]&&delete e.localStreams[n.streamid],V&&n.onended&&n.onended();var t=Boolean((n.getAudioTracks||n.getVideoTracks)&&(n.getAudioTracks()[0]&&!n.getAudioTracks()[0].stop||n.getVideoTracks()[0]&&!n.getVideoTracks()[0].stop));return!n.getAudioTracks||t?void(n.stop&&n.stop()):(n.getAudioTracks().length&&n.getAudioTracks()[0].stop&&n.getAudioTracks().forEach(function(e){e.stop()}),void(n.getVideoTracks().length&&n.getVideoTracks()[0].stop&&n.getVideoTracks().forEach(function(e){e.stop()})))},e.changeBandwidth=function(n){if(!n||s(n)||r(n))throw'Invalid "bandwidth" arguments.';u(e.peers,function(e){e.peer.bandwidth=n}),e.renegotiate()},e.openSignalingChannel=function(n){if(!window.Firebase)return y(e.resources.firebase,function(){e.openSignalingChannel(n)});var t=n.channel||e.channel;e.firebase&&(e.resources.firebaseio=e.resources.firebaseio.replace("//chat.","//"+e.firebase+"."));var i=new Firebase(e.resources.firebaseio+t);i.channel=t,i.on("child_added",function(e){n.onmessage(e.val())}),i.send=function(e){for(var n in e)(o(e[n])||"function"==typeof e[n])&&(e[n]=!1);this.push(e)},e.socket||(e.socket=i),i.onDisconnect().remove(),
setTimeout(function(){n.callback(i)},1)},e.Plugin=oe}window.RMCDefaultChannel=location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""),window.RTCMultiConnection=function(a){function d(n){return Q&&R(),w?n():void(w=new e(T,n))}function u(e,n){if(s(e)&&(T.skipOnNewSession=!0),!w)return m("Signaling channel is not ready. Connecting..."),void d(function(){m("Signaling channel is connected. Joining the session again..."),setTimeout(function(){u(e,n)},1e3)});if(s(e)){if(!T.sessionDescriptions[e])return setTimeout(function(){m("Session-Descriptions not found. Rechecking.."),u(e,n)},1e3);e=T.sessionDescriptions[e]}if(n)return h(function(){e.oneway=!0,u(e)},n);if(!e||!e.userid||!e.sessionid){t("missing arguments",arguments);var t='Invalid data passed over "connection.join" method.';throw T.onstatechange({userid:"browser",extra:{},name:"Unexpected data detected.",reason:t}),t}T.dontOverrideSession||(T.session=e.session);var o=T.extra||e.extra||{};e.oneway||i(e)?w.joinSession(e,o):h(function(){w.joinSession(e,o)})}function h(e,n,t){function o(t){if(t.data&&t.data.chromeMediaSourceId){window.removeEventListener("message",o);var i=t.data.chromeMediaSourceId;if(DetectRTC.screen.sourceId=i,DetectRTC.screen.chromeMediaSource="desktop","PermissionDeniedError"==i){var s={message:"https:"==location.protocol?"User denied to share content of his screen.":ne,name:"PermissionDeniedError",constraintName:u,session:d};return de.mutex=!1,DetectRTC.screen.sourceId=null,T.onMediaError(s)}h(e,n)}t.data&&t.data.chromeExtensionStatus&&(f("Screen capturing extension status is:",t.data.chromeExtensionStatus),DetectRTC.screen.chromeMediaSource="screen",h(e,n,!0))}function a(n,t,i,o){if(T.onstatechange({userid:"browser",extra:{},name:"fetching-usermedia",reason:"About to capture user-media with constraints: "+p(n)}),T.preventSSLAutoAllowed&&!o&&B)return navigator.customGetUserMediaBar?void navigator.customGetUserMediaBar(n,function(){a(n,t,i,!0)},function(){T.onMediaError({name:"PermissionDeniedError",message:"User denied permission.",constraintName:n,session:d})}):void y(T.resources.customGetUserMediaBar,function(){a(n,t,i,o)});var r={onsuccess:function(e,o,s,r){S(e,o,s,r,n,t,i,u,c,d)},onerror:function(n,t){if(V&&"PERMISSION_DENIED"==n&&(n={message:"",name:"PermissionDeniedError",constraintName:t,session:d}),V&&t.video&&t.video.mozMediaSource)return i={message:ee,name:n.name||"PermissionDeniedError",constraintName:t,session:d},void T.onMediaError(i);if(s(n))return T.onMediaError({message:"Unknown Error",name:n,constraintName:t,session:d});if(n.name&&("PermissionDeniedError"==n.name||"DevicesNotFoundError"==n.name)){var i="Either: ";i+="\n Media resolutions are not permitted.",i+="\n Another application is using same media device.",i+="\n Media device is not attached or drivers not installed.",i+="\n You denied access once and it is still denied.",n.message&&n.message.length&&(i+="\n "+n.message),i={message:i,name:n.name,constraintName:t,session:d},T.onMediaError(i),B&&(d.audio||d.video)&&DetectRTC.load(function(){d.audio&&!DetectRTC.hasMicrophone&&(f("It seems that you have no microphone attached to your device/system."),d.audio=d.audio=!1,d.video||(alert("It seems that you are capturing microphone and there is no device available or access is denied. Reloading..."),location.reload())),d.video&&!DetectRTC.hasWebcam&&(f("It seems that you have no webcam attached to your device/system."),d.video=d.video=!1,d.audio||(alert("It seems that you are capturing webcam and there is no device available or access is denied. Reloading..."),location.reload())),DetectRTC.hasMicrophone||DetectRTC.hasWebcam?T.getUserMediaPromptedOnce||(T.getUserMediaPromptedOnce=!0,h(e,d)):(alert("It seems that either both microphone/webcam are not available or access is denied. Reloading..."),location.reload())})}if(n.name&&"ConstraintNotSatisfiedError"==n.name){var i="Either: ";i+="\n You are prompting unknown media resolutions.",i+="\n You are using invalid media constraints.",n.message&&n.message.length&&(i+="\n "+n.message),i={message:i,name:n.name,constraintName:t,session:d},T.onMediaError(i)}d.screen&&(V?l(ee):"https:"!==location.protocol?q||"file:"!=location.protocol&&"http:"!=location.protocol||l("You cannot use HTTP or file protocol for screen capturing. You must either use HTTPs or chrome extension page or Node-Webkit page."):l('Unable to detect actual issue. Maybe "deprecated" screen capturing flag was not set using command line or maybe you clicked "No" button or maybe chrome extension returned invalid "sourceId". Please install chrome-extension: http://bit.ly/webrtc-screen-extension')),de.mutex=!1;var o=JSON.stringify(t);de.streams[o]&&delete de.streams[o]},mediaConstraints:T.mediaConstraints||{}};r.constraints=n||c,r.connection=T,O(r)}var d=n||T.session;if(r(d))return void(e&&e());if(T.dontCaptureUserMedia)return e();if(i(d)||!T.isInitiator&&d.oneway)return T.attachStreams=[],e();var c={audio:d.audio?{mandatory:{},optional:[{chromeRenderToAssociatedSink:!0}]}:!1,video:!!d.video};if(T._mediaSources.audio&&c.audio.optional.push({sourceId:T._mediaSources.audio}),T._mediaSources.audiooutput&&c.audio.optional.push({sourceId:T._mediaSources.audiooutput}),T._mediaSources.audioinput&&c.audio.optional.push({sourceId:T._mediaSources.audioinput}),T._mediaSources.video&&(c.video={optional:[{sourceId:T._mediaSources.video}]}),T._mediaSources.videoinput&&(c.video={optional:[{sourceId:T._mediaSources.videoinput}]}),!d.screen&&!c.audio&&!c.video)return e();var u={audio:!1,video:{mandatory:{chromeMediaSource:DetectRTC.screen.chromeMediaSource,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]}};if(V&&d.screen){if("https:"!==location.protocol)return l(ne);f(ee),u.video={mozMediaSource:"window",mediaSource:"window"},c.audio&&(u.audio=!0,c={}),delete u.video.chromeMediaSource}if(d.screen){if(B&&DetectRTC.screen.extensionid!=te&&(ie=!0),B&&!ie&&!t&&!DetectRTC.screen.sourceId)return U("message",o),Q||R(),void Q.postMessage();if(B&&ie&&!t&&"screen"==DetectRTC.screen.chromeMediaSource&&DetectRTC.screen.extensionid)return DetectRTC.screen.extensionid==te&&-1==document.domain.indexOf("webrtc-experiment.com")?h(e,n,!0):(m("checking if chrome extension is installed."),void DetectRTC.screen.getChromeExtensionStatus(function(t){"installed-enabled"==t&&(DetectRTC.screen.chromeMediaSource="desktop"),h(e,n,!0),m("chrome extension is installed?","desktop"==DetectRTC.screen.chromeMediaSource)}));if(B&&ie&&"desktop"==DetectRTC.screen.chromeMediaSource&&!DetectRTC.screen.sourceId)return void DetectRTC.screen.getSourceId(function(t){if("PermissionDeniedError"==t){var i={message:"User denied to share content of his screen.",name:"PermissionDeniedError",constraintName:u,session:d};return de.mutex=!1,DetectRTC.screen.chromeMediaSource="desktop",T.onMediaError(i)}return"No-Response"==t?(l("Chrome extension seems not available. Make sure that manifest.json#L16 has valid content-script matches pointing to your URL."),DetectRTC.screen.chromeMediaSource="screen",h(e,n,!0)):void h(e,n,!0)});B&&"desktop"==DetectRTC.screen.chromeMediaSource&&(u.video.mandatory.chromeMediaSourceId=DetectRTC.screen.sourceId);var v=x;a(u,c.audio||c.video?function(){v&&(x=!0),a(c,e)}:e)}else a(c,e,d.audio&&!d.video)}function S(e,i,o,s,r,a,d,u,m,l){s||(s=t()),T.onstatechange({userid:"browser",extra:{},name:"usermedia-fetched",reason:"Captured user media using constraints: "+p(r)}),d&&(e=n(e)),T.localStreamids.push(s),e.onended=function(){h.mediaElement&&!h.mediaElement.parentNode&&document.getElementById(e.streamid)&&(h.mediaElement=document.getElementById(e.streamid)),T.attachStreams.forEach(function(n,t){n==e&&(delete T.attachStreams[t],T.attachStreams=c(T.attachStreams))}),g(h,T),T.streams[s]&&T.removeStream(s);var n=T.streams[s];n&&n.sockets.length&&n.sockets.forEach(function(e){e.send({streamid:n.streamid,stopped:!0})}),de.mutex=!1,de.streams[o]&&delete de.streams[o],DetectRTC.screen.sourceId=null},j||(e.streamid=s,e.isScreen=r==u,e.isVideo=r==m&&!!m.video,e.isAudio=r==m&&!!m.audio&&!m.video,e.preMuted={audio:e.getAudioTracks().length&&!e.getAudioTracks()[0].enabled,video:e.getVideoTracks().length&&!e.getVideoTracks()[0].enabled});var f=v(e,l);f.muted=!0;var h={stream:e,streamid:s,mediaElement:f,blobURL:f.mozSrcObject?URL.createObjectURL(e):f.src,type:"local",userid:T.userid,extra:T.extra,session:l,isVideo:!!e.isVideo,isAudio:!!e.isAudio,isScreen:!!e.isScreen,isInitiator:!!T.isInitiator,rtcMultiConnection:T};x&&T.attachStreams.push(e),x=!1,T.streams[s]=T._getStream(h),i||T.onstream(h),T.setDefaultEventsForMediaElement&&T.setDefaultEventsForMediaElement(f,s),a&&a(e,h),T.onspeaking&&D({stream:e,streamedObject:h,connection:T})}var w,T=this;T.channel=a||RMCDefaultChannel,T.isAcceptNewSession=!0,T.open=function(e){T.isAcceptNewSession=!1,T.isInitiator=!0;var n=!1;return e&&(s(e)?T.sessionid=e:(o(e.transmitRoomOnce)||(T.transmitRoomOnce=e.transmitRoomOnce),o(e.dontTransmit)||(n=e.dontTransmit),o(e.sessionid)||(T.sessionid=e.sessionid))),T.socket&&T.socket.remove&&T.socket.remove(),T.sessionid||(T.sessionid=T.channel),T.sessionDescription={sessionid:T.sessionid,userid:T.userid,session:T.session,extra:T.extra},T.sessionDescriptions[T.sessionDescription.sessionid]||(T.numberOfSessions++,T.sessionDescriptions[T.sessionDescription.sessionid]=T.sessionDescription),d(function(){w.captureUserMediaOnDemand=e?!!e.captureUserMediaOnDemand:!1,e&&e.onMediaCaptured&&(T.onMediaCaptured=e.onMediaCaptured),w.captureUserMediaOnDemand||h(function(){w.initSession({sessionDescription:T.sessionDescription,dontTransmit:n}),C(T)}),w.captureUserMediaOnDemand&&w.initSession({sessionDescription:T.sessionDescription,dontTransmit:n})}),T.sessionDescription},T.connect=function(e){return e&&(T.sessionid=e),d(function(){m("Signaling channel is ready.")}),this},T.join=u,T.send=function(e,n){if(T.numberOfConnectedUsers<=0)return void setTimeout(function(){T.send(e,n)},1e3);if(!e)throw"No file, data or text message to share.";if(e instanceof Array&&!o(e[0].size)&&!o(e[0].type))for(var t=0;t<e.length;t++)e[t].size&&e[t].type&&T.send(e[t],n);else if(o(e.size)||o(e.type))le.send({text:e,channel:w,_channel:n,connection:T});else{if(!T.enableFileSharing)throw'"enableFileSharing" boolean MUST be "true" to support file sharing.';if(!w.fileBufferReader)return void k(T,function(t){w.fileBufferReader=t,T.send(e,n)});var i=b({userid:T.userid},e.extra||T.extra);w.fileBufferReader.readAsArrayBuffer(e,function(e){w.fileBufferReader.getNextChunk(e,function(e,t,i){n?n.send(e):w.send(e)})},i)}},T.disconnect=function(){w&&w.disconnect(),w=null};var x=!0;T.captureUserMedia=h,T.leave=function(e){return w?(x=!0,e?void T.eject(e):void w.leave()):void 0},T.eject=function(e){if(!T.isInitiator)throw"Only session-initiator can eject a user.";if(!T.peers[e])throw"You ejected invalid user.";T.peers[e].sendCustomMessage({ejected:!0})},T.close=function(){T.autoCloseEntireSession=!0,T.leave()},T.renegotiate=function(e,n){return T.numberOfConnectedUsers<=0?void setTimeout(function(){T.renegotiate(e,n)},1e3):void w.addStream({renegotiate:n||b({oneway:!0},T.session),stream:e})},T.attachExternalStream=function(e,n){var t={};e.getAudioTracks&&e.getAudioTracks().length&&(t.audio=!0),e.getVideoTracks&&e.getVideoTracks().length&&(t.video=!0);var i={video:{chromeMediaSource:"fake"}},o=n?i:t;S(e,!1,"",null,o,!1,!1,i,t,t)},T.addStream=function(e,n){function t(t){w.addStream({stream:t,renegotiate:e||T.session,socket:n})}if(T.numberOfConnectedUsers<=0)return void setTimeout(function(){T.addStream(e,n)},1e3);if(e){var i;!T.isInitiator&&e.oneway&&(e.oneway=!1,i=!0),h(function(n){i&&(e.oneway=!0),t(n)},e)}else t()},T.removeStream=function(e,n){function t(e,n){n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||(n.screen&&e.isScreen&&T.detachStreams.push(e.streamid),n.audio&&e.isAudio&&T.detachStreams.push(e.streamid),n.video&&e.isVideo&&T.detachStreams.push(e.streamid),n.audio||n.video||n.screen||T.detachStreams.push(e.streamid),-1!=T.detachStreams.indexOf(e.streamid)&&(m("removing stream",e.streamid),g(e,T),n.stop&&T.stopMediaStream(e.stream)))}if(T.numberOfConnectedUsers<=0)return void setTimeout(function(){T.removeStream(e,n)},1e3);if(e||(e="all"),!s(e)||-1!=e.search(/all|audio|video|screen/gi)){for(var i in T.streams)if(-1==T._skip.indexOf(i))if(_stream=T.streams[i],"all"==e)t(_stream,{audio:!0,video:!0,screen:!0});else if(s(e)){var o={};o[e]=!0,t(_stream,o)}else t(_stream,e);return void(!n&&T.detachStreams.length&&T.renegotiate())}var i=T.streams[e];return i?(T.detachStreams.push(i.streamid),m("removing stream",i.streamid),g(i,T),void(n||T.renegotiate())):f("No such stream exists. Stream-id:",e)},T.switchStream=function(e){return T.numberOfConnectedUsers<=0?void setTimeout(function(){T.switchStream(e)},1e3):(T.removeStream("all",!0),void T.addStream(e))},T.sendCustomMessage=function(e){return w&&w.defaultSocket?void w.defaultSocket.send({customMessage:!0,message:e}):setTimeout(function(){T.sendCustomMessage(e)},1e3)},L(T)};var N=[],F=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,V="undefined"!=typeof window.InstallTrigger,_=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,B=!!window.chrome&&!F,j=!!document.documentMode,W=_||j,H=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),q=!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]);window.MediaStream=window.MediaStream||window.webkitMediaStream,window.AudioContext=window.AudioContext||window.webkitAudioContext;var z=50,G=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);B&&G&&G[2]&&(z=parseInt(G[2],10));var J=50;G=navigator.userAgent.match(/Firefox\/(.*)/),V&&G&&G[1]&&(J=parseInt(G[1],10));var Y=window.console||{log:function(){},error:function(){},warn:function(){}};if(B||V||_)var m=Y.log.bind(Y),l=Y.error.bind(Y),f=Y.warn.bind(Y);var Q,X,K,$={},Z={},ee='Make sure that you are using Firefox Nightly and you enabled: media.getusermedia.screensharing.enabled flag from about:config page. You also need to add your domain in "media.getusermedia.screensharing.allowed_domains" flag. If you are using WinXP then also enable "media.getusermedia.screensharing.allow_on_old_platforms" flag. NEVER forget to use "only" HTTPs for screen capturing!',ne="HTTPs i.e. SSL-based URI is mandatory to use screen capturing.",te="ajhifddimkapgcifgcodmmfdlknahffk",ie=-1!=document.domain.indexOf("webrtc-experiment.com");attachEventListener=function(e,n,t,i){e.addEventListener(n,t,i)};var oe=window.PluginRTC||{};window.onPluginRTCInitialized=function(e){oe=e,MediaStreamTrack=oe.MediaStreamTrack,re=oe.RTCPeerConnection,ue=oe.RTCIceCandidate,ce=oe.RTCSessionDescription,m(W?"Java-Applet":"ActiveX","plugin has been loaded.")},r(oe)||window.onPluginRTCInitialized(oe),W&&y("https://cdn.webrtc-experiment.com/Plugin.EveryWhere.js");var se=window.MediaStream;"undefined"==typeof se&&"undefined"!=typeof webkitMediaStream&&(se=webkitMediaStream),"undefined"==typeof se||"stop"in se.prototype||(se.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop()}),this.getVideoTracks().forEach(function(e){e.stop()})});var re,ae={mandatory:{},optional:[]},de={streams:[],mutex:!1,queueRequests:[]},ce=window.RTCSessionDescription||window.mozRTCSessionDescription,ue=window.RTCIceCandidate||window.mozRTCIceCandidate;"undefined"!=typeof mozRTCPeerConnection?re=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection?re=webkitRTCPeerConnection:"undefined"!=typeof window.RTCPeerConnection?re=window.RTCPeerConnection:Y.error("WebRTC 1.0 (RTCPeerConnection) API seems NOT available in this browser.");var me={SaveToDisk:P},le={send:function(e){function n(e,t){var s={type:"text",uuid:m,sendingTime:l};e&&(t=e,s.packets=parseInt(t.length/d)),t.length>d?s.message=t.slice(0,d):(s.message=t,s.last=!0,s.isobject=u),o.send(s,r),c=t.slice(s.message.length),c.length&&setTimeout(function(){n(null,c)},i.chunkInterval||100)}var i=e.connection;if(e.text instanceof ArrayBuffer||e.text instanceof DataView)return e.channel.send(e.text,e._channel);var o=e.channel,r=e._channel,a=e.text,d=i.chunkSize||1e3,c="",u=!1;s(a)||(u=!0,a=JSON.stringify(a));var m=t(),l=(new Date).getTime();n(a)}};!function(){"use strict";function e(){var e,n,t,i=(o.appVersion,o.userAgent),s=o.appName,a=""+parseFloat(o.appVersion),d=parseInt(o.appVersion,10);return-1!==(n=i.indexOf("Opera"))?(s="Opera",a=i.substring(n+6),-1!==(n=i.indexOf("Version"))&&(a=i.substring(n+8))):-1!==(n=i.indexOf("MSIE"))?(s="IE",a=i.substring(n+5)):-1!==(n=i.indexOf("Chrome"))?(s="Chrome",a=i.substring(n+7)):-1!==(n=i.indexOf("Safari"))?(s="Safari",a=i.substring(n+7),-1!==(n=i.indexOf("Version"))&&(a=i.substring(n+8))):-1!==(n=i.indexOf("Firefox"))?(s="Firefox",a=i.substring(n+8)):(e=i.lastIndexOf(" ")+1)<(n=i.lastIndexOf("/"))&&(s=i.substring(e,n),a=i.substring(n+1),s.toLowerCase()===s.toUpperCase()&&(s=o.appName)),r&&(s="Edge",a=parseInt(o.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10)),-1!==(t=a.indexOf(";"))&&(a=a.substring(0,t)),-1!==(t=a.indexOf(" "))&&(a=a.substring(0,t)),d=parseInt(""+a,10),isNaN(d)&&(a=""+parseFloat(o.appVersion),d=parseInt(o.appVersion,10)),{fullVersion:a,version:d,name:s}}function n(e){t(function(n){e(n.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?"Local: "+n:"Public: "+n)})}function t(e){function n(n){var i=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,o=i.exec(n)[1];void 0===t[o]&&e(o),t[o]=!0}var t={},i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,o=!!window.webkitRTCPeerConnection;if(!i){var s=document.getElementById("iframe");if(!s)throw"NOTE: you need to have an iframe in the page right above the script tag.";var r=s.contentWindow;i=r.RTCPeerConnection||r.mozRTCPeerConnection||r.webkitRTCPeerConnection,o=!!r.webkitRTCPeerConnection}var a,d={optional:[{RtpDataChannels:!0}]};o&&(a={iceServers:[{urls:"stun:stun.services.mozilla.com"}]},"undefined"!=typeof v&&v.browser.isFirefox&&v.browser.version<=38&&(a[0]={url:a[0].urls}));var c=new i(a,d);c.onicecandidate=function(e){e.candidate&&n(e.candidate.candidate)},c.createDataChannel(""),c.createOffer(function(e){c.setLocalDescription(e,function(){},function(){})},function(){}),setTimeout(function(){var e=c.localDescription.sdp.split("\n");e.forEach(function(e){0===e.indexOf("a=candidate:")&&n(e)})},1e3)}function i(e){return!o.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(o.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!o.enumerateDevices&&o.enumerateDevices&&(o.enumerateDevices=o.enumerateDevices.bind(o)),o.enumerateDevices?(m=[],void o.enumerateDevices(function(n){n.forEach(function(e){var n={};for(var t in e)n[t]=e[t];var i;m.forEach(function(e){e.id===n.id&&(i=!0)}),i||("audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label||(n.label="Please invoke getUserMedia once.",g||(n.label="HTTPs is required to get label of this "+n.kind+" device.")),("audioinput"===n.kind||"audio"===n.kind)&&(f=!0),"audiooutput"===n.kind&&(p=!0),("videoinput"===n.kind||"video"===n.kind)&&(h=!0),m.push(n))}),"undefined"!=typeof v&&(v.MediaDevices=m,v.hasMicrophone=f,v.hasSpeakers=p,v.hasWebcam=h),e&&e()})):void(e&&e())}var o=window.navigator;o.mediaDevices&&o.mediaDevices.enumerateDevices&&(o.enumerateDevices=function(e){o.mediaDevices.enumerateDevices().then(e)}),"undefined"!=typeof o?("undefined"!=typeof o.webkitGetUserMedia&&(o.getUserMedia=o.webkitGetUserMedia),"undefined"!=typeof o.mozGetUserMedia&&(o.getUserMedia=o.mozGetUserMedia)):o={getUserMedia:function(){}};var s=!!o.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),r=!(-1===o.userAgent.indexOf("Edge")||!o.msSaveOrOpenBlob&&!o.msSaveBlob),a={Android:function(){return o.userAgent.match(/Android/i)},BlackBerry:function(){return o.userAgent.match(/BlackBerry/i)},iOS:function(){return o.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return o.userAgent.match(/Opera Mini/i)},Windows:function(){return o.userAgent.match(/IEMobile/i)},any:function(){return a.Android()||a.BlackBerry()||a.iOS()||a.Opera()||a.Windows()},getOsName:function(){var e="Unknown OS";return a.Android()&&(e="Android"),a.BlackBerry()&&(e="BlackBerry"),a.iOS()&&(e="iOS"),a.Opera()&&(e="Opera Mini"),a.Windows()&&(e="Windows"),e}},d="Unknown OS";a.any()?d=a.getOsName():(-1!==o.appVersion.indexOf("Win")&&(d="Windows"),-1!==o.appVersion.indexOf("Mac")&&(d="MacOS"),-1!==o.appVersion.indexOf("X11")&&(d="UNIX"),-1!==o.appVersion.indexOf("Linux")&&(d="Linux"));var c=!1,u=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(c=!0),e in document.createElement("video")&&(u=!0)});var m=[],l=!1;"undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?l=!0:o.mediaDevices&&o.mediaDevices.enumerateDevices&&(l=!0);var f=l,p=l,h=l;i();var v={};v.browser=e(),v.browser["is"+v.browser.name]=!0;var g="https:"===location.protocol,S=(!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]),!1);["webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){e in window&&(S=!0)}),v.isWebRTCSupported=S,v.isORTCSupported="undefined"!=typeof RTCIceGatherer;var w=!1;v.browser.isChrome&&v.browser.version>=35?w=!0:v.browser.isFirefox&&v.browser.version>=34&&(w=!0),g||(w=!1),v.isScreenCapturingSupported=w;var C={};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){C.isSupported&&C.isCreateMediaStreamSourceSupported||e in window&&(C.isSupported=!0,"createMediaStreamSource"in window[e].prototype&&(C.isCreateMediaStreamSourceSupported=!0))}),v.isAudioContextSupported=C.isSupported,v.isCreateMediaStreamSourceSupported=C.isCreateMediaStreamSourceSupported;var b=!1;v.browser.isChrome&&v.browser.version>31&&(b=!0),v.isRtpDataChannelsSupported=b;var y=!1;if(v.browser.isFirefox&&v.browser.version>28?y=!0:v.browser.isChrome&&v.browser.version>25?y=!0:v.browser.isOpera&&v.browser.version>=11&&(y=!0),v.isSctpDataChannelsSupported=y,v.isMobileDevice=s,v.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,v.isWebSocketsBlocked="Checking",v.isWebSocketsSupported){var T=new WebSocket("wss://echo.websocket.org:443/");T.onopen=function(){v.isWebSocketsBlocked=!1,v.loadCallback&&v.loadCallback()},T.onerror=function(){v.isWebSocketsBlocked=!0,v.loadCallback&&v.loadCallback()}}var k=!1;o.getUserMedia?k=!0:o.mediaDevices&&o.mediaDevices.getUserMedia&&(k=!0),v.browser.isChrome&&v.browser.version>=47&&!g&&(v.isGetUserMediaSupported="Requires HTTPs"),v.isGetUserMediaSupported=k,v.osName=d,v.isCanvasSupportsStreamCapturing=c,v.isVideoSupportsStreamCapturing=u,v.DetectLocalIPAddress=n,v.load=function(e){this.loadCallback=e,i(e)},v.MediaDevices=m,v.hasMicrophone=f,v.hasSpeakers=p,v.hasWebcam=h;var R=!1;"setSinkId"in document.createElement("video")&&(R=!0),v.isSetSinkIdSupported=R;var x=!1;v.browser.isFirefox?"getSenders"in mozRTCPeerConnection.prototype&&(x=!0):v.browser.isChrome&&"getSenders"in webkitRTCPeerConnection.prototype&&(x=!0),v.isRTPSenderReplaceTracksSupported=x;var M=!1;v.browser.isFirefox&&v.browser.version>38&&(M=!0),v.isRemoteStreamProcessingSupported=M;var D=!1;"undefined"!=typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(D=!0),v.isApplyConstraintsSupported=D;var O=!1;v.browser.isFirefox&&v.browser.version>=43&&(O=!0),v.isMultiMonitorScreenCapturingSupported=O,window.DetectRTC=v}();var fe;DetectRTC.screen={chromeMediaSource:"screen",extensionid:te,getSourceId:function(e){function n(n){return"installed-enabled"==n?(fe=e,void window.postMessage("get-sourceId","*")):(DetectRTC.screen.chromeMediaSource="screen",void e("No-Response"))}if(!e)throw'"callback" parameter is mandatory.';DetectRTC.screen.status?n(DetectRTC.screen.status):DetectRTC.screen.getChromeExtensionStatus(n)},onMessageCallback:function(e){if(s(e)||e.sourceId){if(m("chrome message",e),"PermissionDeniedError"==e){if(DetectRTC.screen.chromeMediaSource="PermissionDeniedError",fe)return fe("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(DetectRTC.screen.chromeMediaSource="desktop",DetectRTC.screen.onScreenCapturingExtensionAvailable&&(DetectRTC.screen.onScreenCapturingExtensionAvailable(),DetectRTC.screen.onScreenCapturingExtensionAvailable=null)),e.sourceId&&(DetectRTC.screen.sourceId=e.sourceId,fe&&fe(DetectRTC.screen.sourceId))}},getChromeExtensionStatus:function(e,n){function t(e){DetectRTC.screen.status=e,n(e)}if(V)return t("not-chrome");2!=arguments.length&&(n=e,e=this.extensionid);var i=document.createElement("img");i.src="chrome-extension://"+e+"/icon.png",i.onload=function(){DetectRTC.screen.chromeMediaSource="screen",window.postMessage("are-you-there","*"),setTimeout(function(){t("screen"==DetectRTC.screen.chromeMediaSource?"desktop"==DetectRTC.screen.chromeMediaSource?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},i.onerror=function(){t("not-installed")}}},window.addEventListener||(window.addEventListener=function(e,n,t){e.attachEvent&&e.attachEvent("on"+n,t)}),window.addEventListener("message",function(e){e.origin==window.location.origin&&DetectRTC.screen.onMessageCallback(e.data)})}();

//CodecsHandler
var CodecsHandler=function(){function e(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=e.replace("a=rtpmap:100 VP8/90000\r\n",""),e=e.replace("a=rtpmap:101 VP9/90000\r\n",""),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 100/g,"m=video $1 RTP/SAVPF $2"),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 101/g,"m=video $1 RTP/SAVPF $2"),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF 100([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2"),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF 101([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2"),e=e.replace("a=rtcp-fb:120 nack\r\n",""),e=e.replace("a=rtcp-fb:120 nack pli\r\n",""),e=e.replace("a=rtcp-fb:120 ccm fir\r\n",""),e=e.replace("a=rtcp-fb:101 nack\r\n",""),e=e.replace("a=rtcp-fb:101 nack pli\r\n",""),e=e.replace("a=rtcp-fb:101 ccm fir\r\n","")}function r(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=e.replace("a=rtcp-fb:126 nack\r\n",""),e=e.replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n"),e=e.replace("a=rtcp-fb:97 nack\r\n",""),e=e.replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")}function n(e,r){if(r&&r.getSenders&&r.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";r.getSenders().forEach(function(r){for(var n=r.getParameters(),a=0;a<n.codecs.length;a++)if(n.codecs[a].mimeType==e){n.codecs.unshift(n.codecs.splice(a,1));break}r.setParameters(n)})}}function a(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")}function t(e,r,n){return r?"undefined"!=typeof isFirefox&&isFirefox?e:u?e:(n&&(r.screen?r.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),r.screen&&n&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+r.screen+"\r\n")),(r.audio||r.video||r.data)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),r.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+r.audio+"\r\n")),r.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(n?r.screen:r.video)+"\r\n")),e):e}function i(e,r,n){return o(e,0,-1,r,n)}function o(e,r,n,a,t){for(var i=-1!==n?n:e.length,o=r;i>o;++o)if(0===e[o].indexOf(a)&&(!t||-1!==e[o].toLowerCase().indexOf(t.toLowerCase())))return o;return null}function c(e){var r=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),n=e.match(r);return n&&2===n.length?n[1]:null}function d(e,r){if(u)return e;r=r||{};var n,a=r.min,t=r.max,o=e.split("\r\n"),d=i(o,"a=rtpmap","VP8/90000");if(d&&(n=c(o[d])),!n)return e;var p,f=i(o,"a=rtpmap","rtx/90000");if(f&&(p=c(o[f])),!f)return e;var s=i(o,"a=fmtp:"+p.toString());if(null!==s){var l="\r\n";l+="a=fmtp:"+n+" x-google-min-bitrate="+(a||"228")+"; x-google-max-bitrate="+(t||"228"),o[s]=o[s].concat(l),e=o.join("\r\n")}return e}function p(e,r){if(u)return e;r=r||{};var n,a=e.split("\r\n"),t=i(a,"a=rtpmap","opus/48000");if(t&&(n=c(a[t])),!n)return e;var o=i(a,"a=fmtp:"+n.toString());if(null===o)return e;var d="";return d+="; stereo="+("undefined"!=typeof r.stereo?r.stereo:"1"),d+="; sprop-stereo="+("undefined"!=typeof r["sprop-stereo"]?r["sprop-stereo"]:"1"),"undefined"!=typeof r.maxaveragebitrate&&(d+="; maxaveragebitrate="+(r.maxaveragebitrate||1048576)),"undefined"!=typeof r.maxplaybackrate&&(d+="; maxplaybackrate="+(r.maxplaybackrate||1048576)),"undefined"!=typeof r.cbr&&(d+="; cbr="+("undefined"!=typeof r.cbr?r.cbr:"1")),"undefined"!=typeof r.useinbandfec&&(d+="; useinbandfec="+r.useinbandfec),"undefined"!=typeof r.usedtx&&(d+="; usedtx="+r.usedtx),"undefined"!=typeof r.maxptime&&(d+="\r\na=maxptime:"+r.maxptime),a[o]=a[o].concat(d),e=a.join("\r\n")}function f(e){return-1===e.indexOf("SAVPF 100 101")||-1===e.indexOf("VP9/90000")?e:e.replace("SAVPF 100 101","SAVPF 101 100")}var u=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);return"undefined"!=typeof cordova&&(u=!0),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(u=!0),{removeVPX:e,disableNACK:r,prioritize:n,removeNonG722:a,setApplicationSpecificBandwidth:function(e,r,n){return t(e,r,n)},setVideoBitrates:function(e,r){return d(e,r)},setOpusAttributes:function(e,r){return p(e,r)},preferVP9:f}}();window.BandwidthHandler=CodecsHandler;
//
!function(){function C(){return function(){}}function la(){return"x"+ ++ca+ +new Date}function G(){return+new Date}function qa(e,n){var t=e.join(ia),r=[];return n?(N(n,function(e,n){var t="object"==typeof n?JSON.stringify(n):n;"undefined"!=typeof n&&n!=z&&0<encodeURIComponent(t).length&&r.push(e+"="+encodeURIComponent(t))}),t+="?"+r.join(ja)):t}function ra(e,n){function t(){a+n>G()?(clearTimeout(r),r=setTimeout(t,n)):(a=G(),e())}var r,a=0;return t}function sa(e,n){var t=[];return N(e||[],function(e){n(e)&&t.push(e)}),t}function ta(e,n){return e.replace(ka,function(e,t){return n[t]||e})}function pa(e){var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return("x"==e?n:3&n|8).toString(16)});return e&&e(n),n}function N(e,n){if(e&&n)if(e&&(Array.isArray&&Array.isArray(e)||"number"==typeof e.length))for(var t=0,r=e.length;r>t;)n.call(e[t],e[t],t++);else for(t in e)e.hasOwnProperty&&e.hasOwnProperty(t)&&n.call(e[t],t,e[t])}function ua(e,n){var t=[];return N(e||[],function(e,r){t.push(n(e,r))}),t}function va(e,n){var t=[];return N(e,function(e,r){n?0>e.search("-pnpres")&&r.f&&t.push(e):r.f&&t.push(e)}),t.sort()}function wa(){setTimeout(function(){fa||(fa=1,N(ga,function(e){e()}))},D)}function ya(e,n){var t,r,a="";if(n){if(t=e[15],t>16)throw"Decryption error: Maybe bad key";if(16==t)return"";for(r=0;16-t>r;r++)a+=String.fromCharCode(e[r])}else for(r=0;16>r;r++)a+=String.fromCharCode(e[r]);return a}function za(e,n){var t,r=[];if(!n)try{e=unescape(encodeURIComponent(e))}catch(a){throw"Error on UTF-8 encode"}for(t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return r}function Aa(e,n){var t,r=T>=12?3:2,a=[],i=[],a=[],i=[],o=e.concat(n);for(a[0]=GibberishAES.l.m(o),i=a[0],t=1;r>t;t++)a[t]=GibberishAES.l.m(a[t-1].concat(o)),i=i.concat(a[t]);return a=i.slice(0,4*U),i=i.slice(4*U,4*U+16),{key:a,i:i}}function Ba(e,n,t){var r,n=Ca(n),a=Math.ceil(e.length/16),i=[],o=[];for(r=0;a>r;r++){var c=i,u=r,s=e.slice(16*r,16*r+16),f=[],l=v,l=v;for(16>s.length&&(l=16-s.length,f=[l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l]),l=0;l<s.length;l++)f[l]=s[l];c[u]=f}for(0===e.length%16&&i.push([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]),r=0;r<i.length;r++)i[r]=0===r?Da(i[r],t):Da(i[r],o[r-1]),o[r]=Ea(i[r],n);return o}function Fa(e,n,t,r){var a,n=Ca(n),i=e.length/16,o=[],c=[],u="";for(a=0;i>a;a++)o.push(e.slice(16*a,16*(a+1)));for(a=o.length-1;a>=0;a--)c[a]=Ga(o[a],n),c[a]=0===a?Da(c[a],t):Da(c[a],o[a-1]);for(a=0;i-1>a;a++)u+=ya(c[a]);var s,u=u+ya(c[a],y);if(r)s=u;else try{s=decodeURIComponent(escape(u))}catch(f){throw"Bad Key"}return s}function Ea(e,n){xa=A;var t,r=La(e,n,0);for(t=1;T+1>t;t++)r=Ma(r),r=Na(r),T>t&&(r=Oa(r)),r=La(r,n,t);return r}function Ga(e,n){xa=y;var t,r=La(e,n,T);for(t=T-1;t>-1;t--)r=Na(r),r=Ma(r),r=La(r,n,t),t>0&&(r=Oa(r));return r}function Ma(e){var n,t=xa?Pa:Qa,r=[];for(n=0;16>n;n++)r[n]=t[e[n]];return r}function Na(e){var n,t=[],r=xa?[0,13,10,7,4,1,14,11,8,5,2,15,12,9,6,3]:[0,5,10,15,4,9,14,3,8,13,2,7,12,1,6,11];for(n=0;16>n;n++)t[n]=e[r[n]];return t}function Oa(e){var n,t=[];if(xa)for(n=0;4>n;n++)t[4*n]=Ta[e[4*n]]^Ua[e[1+4*n]]^Za[e[2+4*n]]^$a[e[3+4*n]],t[1+4*n]=$a[e[4*n]]^Ta[e[1+4*n]]^Ua[e[2+4*n]]^Za[e[3+4*n]],t[2+4*n]=Za[e[4*n]]^$a[e[1+4*n]]^Ta[e[2+4*n]]^Ua[e[3+4*n]],t[3+4*n]=Ua[e[4*n]]^Za[e[1+4*n]]^$a[e[2+4*n]]^Ta[e[3+4*n]];else for(n=0;4>n;n++)t[4*n]=ab[e[4*n]]^bb[e[1+4*n]]^e[2+4*n]^e[3+4*n],t[1+4*n]=e[4*n]^ab[e[1+4*n]]^bb[e[2+4*n]]^e[3+4*n],t[2+4*n]=e[4*n]^e[1+4*n]^ab[e[2+4*n]]^bb[e[3+4*n]],t[3+4*n]=bb[e[4*n]]^e[1+4*n]^e[2+4*n]^ab[e[3+4*n]];return t}function La(e,n,t){var r,a=[];for(r=0;16>r;r++)a[r]=e[r]^n[t][r];return a}function Da(e,n){var t,r=[];for(t=0;16>t;t++)r[t]=e[t]^n[t];return r}function Ca(e){var n,t,r=[],a=[],i=[];for(n=0;U>n;n++)t=[e[4*n],e[4*n+1],e[4*n+2],e[4*n+3]],r[n]=t;for(n=U;4*(T+1)>n;n++){for(r[n]=[],e=0;4>e;e++)a[e]=r[n-1][e];if(0===n%U){for(e=a[0],t=v,t=0;4>t;t++)a[t]=a[t+1];a[3]=e,a=cb(a),a[0]^=db[n/U-1]}else U>6&&4==n%U&&(a=cb(a));for(e=0;4>e;e++)r[n][e]=r[n-U][e]^a[e]}for(n=0;T+1>n;n++)for(i[n]=[],a=0;4>a;a++)i[n].push(r[4*n+a][0],r[4*n+a][1],r[4*n+a][2],r[4*n+a][3]);return i}function cb(e){for(var n=0;4>n;n++)e[n]=Qa[e[n]];return e}function eb(e,n){var t=[];for(i=0;i<e.length;i+=n)t[i/n]=parseInt(e.substr(i,n),16);return t}function fb(e){for(var n=[],t=0;256>t;t++){for(var r=e,a=t,i=v,o=v,i=o=0;8>i;i++)o=1==(1&a)?o^r:o,r=r>127?283^r<<1:r<<1,a>>>=1;n[t]=o}return n}var CryptoJS=CryptoJS||function(e,n){var t={},r=t.lib={},a=function(){},i=r.Base={extend:function(e){a.prototype=this;var n=new a;return e&&n.mixIn(e),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=t!=n?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var n=this.words,t=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var a=0;e>a;a++)n[r+a>>>2]|=(t[a>>>2]>>>24-8*(a%4)&255)<<24-8*((r+a)%4);else if(65535<t.length)for(a=0;e>a;a+=4)n[r+a>>>2]=t[a>>>2];else n.push.apply(n,t);return this.sigBytes+=e,this},clamp:function(){var n=this.words,t=this.sigBytes;n[t>>>2]&=4294967295<<32-8*(t%4),n.length=e.ceil(t/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(n){for(var t=[],r=0;n>r;r+=4)t.push(4294967296*e.random()|0);return new o.init(t,n)}}),c=t.enc={},u=c.Hex={stringify:function(e){var n=e.words;e=e.sigBytes;for(var t=[],r=0;e>r;r++){var a=n[r>>>2]>>>24-8*(r%4)&255;t.push((a>>>4).toString(16)),t.push((15&a).toString(16))}return t.join("")},parse:function(e){for(var n=e.length,t=[],r=0;n>r;r+=2)t[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new o.init(t,n/2)}},s=c.Latin1={stringify:function(e){var n=e.words;e=e.sigBytes;for(var t=[],r=0;e>r;r++)t.push(String.fromCharCode(n[r>>>2]>>>24-8*(r%4)&255));return t.join("")},parse:function(e){for(var n=e.length,t=[],r=0;n>r;r++)t[r>>>2]|=(255&e.charCodeAt(r))<<24-8*(r%4);return new o.init(t,n)}},f=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(n){throw Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(n){var t=this._data,r=t.words,a=t.sigBytes,i=this.blockSize,c=a/(4*i),c=n?e.ceil(c):e.max((0|c)-this._minBufferSize,0);if(n=c*i,a=e.min(4*n,a),n){for(var u=0;n>u;u+=i)this._doProcessBlock(r,u);u=r.splice(0,n),t.sigBytes-=a}return new o.init(u,a)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(n,t){return new e.init(t).finalize(n)}},_createHmacHelper:function(e){return function(n,t){return new b.HMAC.init(e,t).finalize(n)}}});var b=t.algo={};return t}(Math);!function(e){for(var n=CryptoJS,t=n.lib,r=t.WordArray,a=t.Hasher,t=n.algo,i=[],o=[],c=function(e){return 4294967296*(e-(0|e))|0},u=2,s=0;64>s;){var f;e:{f=u;for(var l=e.sqrt(f),b=2;l>=b;b++)if(!(f%b)){f=!1;break e}f=!0}f&&(8>s&&(i[s]=c(e.pow(u,.5))),o[s]=c(e.pow(u,1/3)),s++),u++}var d=[],t=t.SHA256=a.extend({_doReset:function(){this._hash=new r.init(i.slice(0))},_doProcessBlock:function(e,n){for(var t=this._hash.words,r=t[0],a=t[1],i=t[2],c=t[3],u=t[4],s=t[5],f=t[6],l=t[7],b=0;64>b;b++){if(16>b)d[b]=0|e[n+b];else{var h=d[b-15],p=d[b-2];d[b]=((h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3)+d[b-7]+((p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10)+d[b-16]}h=l+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&s^~u&f)+o[b]+d[b],p=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&a^r&i^a&i),l=f,f=s,s=u,u=c+h|0,c=i,i=a,a=r,r=h+p|0}t[0]=t[0]+r|0,t[1]=t[1]+a|0,t[2]=t[2]+i|0,t[3]=t[3]+c|0,t[4]=t[4]+u|0,t[5]=t[5]+s|0,t[6]=t[6]+f|0,t[7]=t[7]+l|0},_doFinalize:function(){var n=this._data,t=n.words,r=8*this._nDataBytes,a=8*n.sigBytes;return t[a>>>5]|=128<<24-a%32,t[(a+64>>>9<<4)+14]=e.floor(r/4294967296),t[(a+64>>>9<<4)+15]=r,n.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=a._createHelper(t),n.HmacSHA256=a._createHmacHelper(t)}(Math),function(){var e=CryptoJS,n=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var r=e.blockSize,a=4*r;t.sigBytes>a&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),c=i.words,u=o.words,s=0;r>s;s++)c[s]^=1549556828,u[s]^=909522486;i.sigBytes=o.sigBytes=a,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var n=this._hasher;return e=n.finalize(e),n.reset(),n.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=CryptoJS,n=e.lib.WordArray;e.enc.Base64={stringify:function(e){var n=e.words,t=e.sigBytes,r=this._map;e.clamp(),e=[];for(var a=0;t>a;a+=3)for(var i=(n[a>>>2]>>>24-8*(a%4)&255)<<16|(n[a+1>>>2]>>>24-8*((a+1)%4)&255)<<8|n[a+2>>>2]>>>24-8*((a+2)%4)&255,o=0;4>o&&t>a+.75*o;o++)e.push(r.charAt(i>>>6*(3-o)&63));if(n=r.charAt(64))for(;e.length%4;)e.push(n);return e.join("")},parse:function(e){var t=e.length,r=this._map,a=r.charAt(64);a&&(a=e.indexOf(a),-1!=a&&(t=a));for(var a=[],i=0,o=0;t>o;o++)if(o%4){var c=r.indexOf(e.charAt(o-1))<<2*(o%4),u=r.indexOf(e.charAt(o))>>>6-2*(o%4);a[i>>>2]|=(c|u)<<24-8*(i%4),i++}return n.create(a,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}();var v=void 0,y=!0,z=null,A=!1;window.JSON&&window.JSON.stringify||function(){function a(){try{return this.valueOf()}catch(e){return z}}function d(e){return c.lastIndex=0,c.test(e)?'"'+e.replace(c,function(e){var n=q[e];return"string"==typeof n?n:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function b(e,n){var t,r,i,o,c,u=f,s=n[e];switch(s&&"object"==typeof s&&(s=a.call(s)),"function"==typeof m&&(s=m.call(n,e,s)),typeof s){case"string":return d(s);case"number":return isFinite(s)?String(s):"null";case"boolean":case"null":return String(s);case"object":if(!s)return"null";if(f+=p,c=[],"[object Array]"===Object.prototype.toString.apply(s)){for(o=s.length,t=0;o>t;t+=1)c[t]=b(t,s)||"null";return i=0===c.length?"[]":f?"[\n"+f+c.join(",\n"+f)+"\n"+u+"]":"["+c.join(",")+"]",f=u,i}if(m&&"object"==typeof m)for(o=m.length,t=0;o>t;t+=1)r=m[t],"string"==typeof r&&(i=b(r,s))&&c.push(d(r)+(f?": ":":")+i);else for(r in s)Object.hasOwnProperty.call(s,r)&&(i=b(r,s))&&c.push(d(r)+(f?": ":":")+i);return i=0===c.length?"{}":f?"{\n"+f+c.join(",\n"+f)+"\n"+u+"}":"{"+c.join(",")+"}",f=u,i}}window.JSON||(window.JSON={});var c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,p,q={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,n,t){var r;if(p=f="","number"==typeof t)for(r=0;t>r;r+=1)p+=" ";else"string"==typeof t&&(p=t);if((m=n)&&"function"!=typeof n&&("object"!=typeof n||"number"!=typeof n.length))throw Error("JSON.stringify");return b("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(a){return eval("("+a+")")})}();var ca=1,fa=A,ga=[],ha="-pnpres",D=1e3,ia="/",ja="&",ka=/{([\w\-]+)}/g,ma,na=Math.floor(20*Math.random());ma=function(e,n){return 0<e.indexOf("pubsub.")&&e.replace("pubsub","ps"+(n?pa().split("-")[0]:20>++na?na:na=1))||e};var O,T=14,U=8,xa=A,Qa=eb("637c777bf26b6fc53001672bfed7ab76ca82c97dfa5947f0add4a2af9ca472c0b7fd9326363ff7cc34a5e5f171d8311504c723c31896059a071280e2eb27b27509832c1a1b6e5aa0523bd6b329e32f8453d100ed20fcb15b6acbbe394a4c58cfd0efaafb434d338545f9027f503c9fa851a3408f929d38f5bcb6da2110fff3d2cd0c13ec5f974417c4a77e3d645d197360814fdc222a908846eeb814de5e0bdbe0323a0a4906245cc2d3ac629195e479e7c8376d8dd54ea96c56f4ea657aae08ba78252e1ca6b4c6e8dd741f4bbd8b8a703eb5664803f60e613557b986c11d9ee1f8981169d98e949b1e87e9ce5528df8ca1890dbfe6426841992d0fb054bb16",2),Pa,gb=Qa,hb=[];for(i=0;i<gb.length;i++)hb[gb[i]]=i;Pa=hb;var db=eb("01020408102040801b366cd8ab4d9a2f5ebc63c697356ad4b37dfaefc591",2),ab=fb(2),bb=fb(3),$a=fb(9),Ua=fb(11),Za=fb(13),Ta=fb(14),ib,jb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",kb=jb.split("");if("function"==typeof Array.indexOf&&(jb=kb),ib={encode:function(e){var n,t=[],r="";for(n=0;n<16*e.length;n++)t.push(e[Math.floor(n/16)][n%16]);for(n=0;n<t.length;n+=3)r+=kb[t[n]>>2],r+=kb[(3&t[n])<<4|t[n+1]>>4],r=t[n+1]!==v?r+kb[(15&t[n+1])<<2|t[n+2]>>6]:r+"=",r=t[n+2]!==v?r+kb[63&t[n+2]]:r+"=";for(e=r.slice(0,64),n=1;n<Math.ceil(r.length/64);n++)e+=r.slice(64*n,64*n+64)+(Math.ceil(r.length/64)==n+1?"":"\n");return e},decode:function(e){var n,e=e.replace(/\n/g,""),t=[],r=[],a=[];for(n=0;n<e.length;n+=4)r[0]=jb.indexOf(e.charAt(n)),r[1]=jb.indexOf(e.charAt(n+1)),r[2]=jb.indexOf(e.charAt(n+2)),r[3]=jb.indexOf(e.charAt(n+3)),a[0]=r[0]<<2|r[1]>>4,a[1]=(15&r[1])<<4|r[2]>>2,a[2]=(3&r[2])<<6|r[3],t.push(a[0],a[1],a[2]);return t=t.slice(0,t.length-t.length%16)}},O={size:function(e){switch(e){case 128:T=10,U=4;break;case 192:T=12,U=6;break;case 256:T=14,U=8;break;default:throw"Invalid Key Size Specified:"+e}},h2a:function(e){var n=[];return e.replace(/(..)/g,function(e){n.push(parseInt(e,16))}),n},expandKey:Ca,encryptBlock:Ea,decryptBlock:Ga,Decrypt:xa,s2a:za,rawEncrypt:Ba,rawDecrypt:Fa,dec:function(e,n,t){var e=ib.q(e),r=e.slice(8,16),r=Aa(za(n,t),r),n=r.key,r=r.i,e=e.slice(16,e.length);return e=Fa(e,n,r,t)},openSSLKey:Aa,a2h:function(e){var n,t="";for(n=0;n<e.length;n++)t+=(16>e[n]?"0":"")+e[n].toString(16);return t},enc:function(e,n,t){var r;r=[];var a;for(a=0;8>a;a++)r=r.concat(Math.floor(256*Math.random()));return a=Aa(za(n,t),r),n=a.key,a=a.i,r=[[83,97,108,116,101,100,95,95].concat(r)],e=za(e,t),e=Ba(e,n,a),e=r.concat(e),ib.s(e)},Hash:{MD5:function(e){function n(e,n){var t,r,a,i,o;return a=2147483648&e,i=2147483648&n,t=1073741824&e,r=1073741824&n,o=(1073741823&e)+(1073741823&n),t&r?2147483648^o^a^i:t|r?1073741824&o?3221225472^o^a^i:1073741824^o^a^i:o^a^i}function t(e,t,r,a,i,o,c){return e=n(e,n(n(t&r|~t&a,i),c)),n(e<<o|e>>>32-o,t)}function r(e,t,r,a,i,o,c){return e=n(e,n(n(t&a|r&~a,i),c)),n(e<<o|e>>>32-o,t)}function a(e,t,r,a,i,o,c){return e=n(e,n(n(t^r^a,i),c)),n(e<<o|e>>>32-o,t)}function i(e,t,r,a,i,o,c){return e=n(e,n(n(r^(t|~a),i),c)),n(e<<o|e>>>32-o,t)}function o(e){var n,t,r=[];for(t=0;3>=t;t++)n=e>>>8*t&255,r=r.concat(n);return r}var c,u,s,f,l,b,d,h,p=[],g=eb("67452301efcdab8998badcfe10325476d76aa478e8c7b756242070dbc1bdceeef57c0faf4787c62aa8304613fd469501698098d88b44f7afffff5bb1895cd7be6b901122fd987193a679438e49b40821f61e2562c040b340265e5a51e9b6c7aad62f105d02441453d8a1e681e7d3fbc821e1cde6c33707d6f4d50d87455a14eda9e3e905fcefa3f8676f02d98d2a4c8afffa39428771f6816d9d6122fde5380ca4beea444bdecfa9f6bb4b60bebfbc70289b7ec6eaa127fad4ef308504881d05d9d4d039e6db99e51fa27cf8c4ac5665f4292244432aff97ab9423a7fc93a039655b59c38f0ccc92ffeff47d85845dd16fa87e4ffe2ce6e0a30143144e0811a1f7537e82bd3af2352ad7d2bbeb86d391",8),p=e.length;for(c=p+8,u=16*((c-c%64)/64+1),s=[],l=f=0;p>l;)c=(l-l%4)/4,f=8*(l%4),s[c]|=e[l]<<f,l++;for(c=(l-l%4)/4,s[c]|=128<<8*(l%4),s[u-2]=p<<3,s[u-1]=p>>>29,p=s,l=g[0],b=g[1],d=g[2],h=g[3],e=0;e<p.length;e+=16)c=l,u=b,s=d,f=h,l=t(l,b,d,h,p[e+0],7,g[4]),h=t(h,l,b,d,p[e+1],12,g[5]),d=t(d,h,l,b,p[e+2],17,g[6]),b=t(b,d,h,l,p[e+3],22,g[7]),l=t(l,b,d,h,p[e+4],7,g[8]),h=t(h,l,b,d,p[e+5],12,g[9]),d=t(d,h,l,b,p[e+6],17,g[10]),b=t(b,d,h,l,p[e+7],22,g[11]),l=t(l,b,d,h,p[e+8],7,g[12]),h=t(h,l,b,d,p[e+9],12,g[13]),d=t(d,h,l,b,p[e+10],17,g[14]),b=t(b,d,h,l,p[e+11],22,g[15]),l=t(l,b,d,h,p[e+12],7,g[16]),h=t(h,l,b,d,p[e+13],12,g[17]),d=t(d,h,l,b,p[e+14],17,g[18]),b=t(b,d,h,l,p[e+15],22,g[19]),l=r(l,b,d,h,p[e+1],5,g[20]),h=r(h,l,b,d,p[e+6],9,g[21]),d=r(d,h,l,b,p[e+11],14,g[22]),b=r(b,d,h,l,p[e+0],20,g[23]),l=r(l,b,d,h,p[e+5],5,g[24]),h=r(h,l,b,d,p[e+10],9,g[25]),d=r(d,h,l,b,p[e+15],14,g[26]),b=r(b,d,h,l,p[e+4],20,g[27]),l=r(l,b,d,h,p[e+9],5,g[28]),h=r(h,l,b,d,p[e+14],9,g[29]),d=r(d,h,l,b,p[e+3],14,g[30]),b=r(b,d,h,l,p[e+8],20,g[31]),l=r(l,b,d,h,p[e+13],5,g[32]),h=r(h,l,b,d,p[e+2],9,g[33]),d=r(d,h,l,b,p[e+7],14,g[34]),b=r(b,d,h,l,p[e+12],20,g[35]),l=a(l,b,d,h,p[e+5],4,g[36]),h=a(h,l,b,d,p[e+8],11,g[37]),d=a(d,h,l,b,p[e+11],16,g[38]),b=a(b,d,h,l,p[e+14],23,g[39]),l=a(l,b,d,h,p[e+1],4,g[40]),h=a(h,l,b,d,p[e+4],11,g[41]),d=a(d,h,l,b,p[e+7],16,g[42]),b=a(b,d,h,l,p[e+10],23,g[43]),l=a(l,b,d,h,p[e+13],4,g[44]),h=a(h,l,b,d,p[e+0],11,g[45]),d=a(d,h,l,b,p[e+3],16,g[46]),b=a(b,d,h,l,p[e+6],23,g[47]),l=a(l,b,d,h,p[e+9],4,g[48]),h=a(h,l,b,d,p[e+12],11,g[49]),d=a(d,h,l,b,p[e+15],16,g[50]),b=a(b,d,h,l,p[e+2],23,g[51]),l=i(l,b,d,h,p[e+0],6,g[52]),h=i(h,l,b,d,p[e+7],10,g[53]),d=i(d,h,l,b,p[e+14],15,g[54]),b=i(b,d,h,l,p[e+5],21,g[55]),l=i(l,b,d,h,p[e+12],6,g[56]),h=i(h,l,b,d,p[e+3],10,g[57]),d=i(d,h,l,b,p[e+10],15,g[58]),b=i(b,d,h,l,p[e+1],21,g[59]),l=i(l,b,d,h,p[e+8],6,g[60]),h=i(h,l,b,d,p[e+15],10,g[61]),d=i(d,h,l,b,p[e+6],15,g[62]),b=i(b,d,h,l,p[e+13],21,g[63]),l=i(l,b,d,h,p[e+4],6,g[64]),h=i(h,l,b,d,p[e+11],10,g[65]),d=i(d,h,l,b,p[e+2],15,g[66]),b=i(b,d,h,l,p[e+9],21,g[67]),l=n(l,c),b=n(b,u),d=n(d,s),h=n(h,f);return o(l).concat(o(b),o(d),o(h))}},Base64:ib},!window.PUBNUB){var lb=function(e,n){return CryptoJS.HmacSHA256(e,n).toString(CryptoJS.enc.Base64)},mb=function(e){return document.getElementById(e)},nb=function(e){console.error(e)},pb=function(e,n){var t=[];return N(e.split(/\s+/),function(e){N((n||document).getElementsByTagName(e),function(e){t.push(e)})}),t},qb=function(e,n,t){N(e.split(","),function(e){function r(e){e||(e=window.event),t(e)||(e.cancelBubble=y,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())}n.addEventListener?n.addEventListener(e,r,A):n.attachEvent?n.attachEvent("on"+e,r):n["on"+e]=r})},rb=function(){return pb("head")[0]},V=function(e,n,t){return t?void e.setAttribute(n,t):e&&e.getAttribute&&e.getAttribute(n)},sb=function(e,n){for(var t in n)if(n.hasOwnProperty(t))try{e.style[t]=n[t]+(0<"|width|height|top|left|".indexOf(t)&&"number"==typeof n[t]?"px":"")}catch(r){}},tb=function(e){return document.createElement(e)},zb=function(){return ub||$()?0:la()},Ab=function(e){function n(e,n){v||(v=1,g.onerror=z,clearTimeout(m),e||!n||w(n),setTimeout(function(){e&&_();var n=mb(y),t=n&&n.parentNode;t&&t.removeChild(n)},D))}if(ub||$()){e:{var t,r,a=function(){if(!o){o=1,clearTimeout(u);try{r=JSON.parse(t.responseText)}catch(e){return d(1)}i=1,l(r)}},i=0,o=0,c=e.timeout||1e4,u=setTimeout(function(){d(1,{message:"timeout"})},c),s=e.b||C(),f=e.data||{},l=e.c||C(),b=!e.h,d=function(e,n){i||(i=1,clearTimeout(u),t&&(t.onerror=t.onload=z,t.abort&&t.abort(),t=z),e&&s(n))};try{t=$()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest,t.onerror=t.onabort=function(){d(1,t.responseText||{error:"Network Connection Error"})},t.onload=t.onloadend=a,t.onreadystatechange=function(){if(t&&4==t.readyState)switch(t.status){case 401:case 402:case 403:try{r=JSON.parse(t.responseText),d(1,r)}catch(e){return d(1,t.responseText)}}};var h=qa(e.url,f);t.open("GET",h,b),b&&(t.timeout=c),t.send()}catch(p){d(0),ub=0,e=Ab(e);break e}e=d}return e}var g=tb("script"),a=e.a,y=la(),v=0,m=setTimeout(function(){n(1,{message:"timeout"})},e.timeout||1e4),_=e.b||C(),c=e.data||{},w=e.c||C();return window[a]=function(e){n(0,e)},e.h||(g[Bb]=Bb),g.onerror=function(){n(1)},g.src=qa(e.url,c),V(g,"id",y),rb().appendChild(g),n},Cb=function(){return"onLine"in navigator?navigator.onLine:1},$=function(){if(!Db||!Db.get)return 0;var e={id:$.id++,send:C(),abort:function(){e.id={}},open:function(n,t){$[e.id]=e,Db.get(e.id,t)}};return e},Bb="async",ub=-1==navigator.userAgent.indexOf("MSIE 6");window.console||(window.console=window.console||{}),console.log||(console.log=console.error=(window.opera||{}).postError||C());var Eb,Fb=window.localStorage;Eb={get:function(e){try{return Fb?Fb.getItem(e):-1==document.cookie.indexOf(e)?z:((document.cookie||"").match(RegExp(e+"=([^;]+)"))||[])[1]||z}catch(n){}},set:function(e,n){try{if(Fb)return Fb.setItem(e,n)&&0;document.cookie=e+"="+n+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(t){}}};var Gb={list:{},unbind:function(e){Gb.list[e]=[]},bind:function(e,n){(Gb.list[e]=Gb.list[e]||[]).push(n)},fire:function(e,n){N(Gb.list[e]||[],function(e){e(n)})}},Ib=mb("pubnub")||0,Jb=function(e){function t(){}function r(e,n){function t(n){n&&(q=G()-(n/1e4+(G()-r)/2),e&&e(q))}var r=G();n&&t(n)||ge.time(t)}function a(e,n){Q&&Q(e,n),Q=z}function i(){ge.time(function(e){r(C(),e),e||a(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),setTimeout(i,T)})}function o(){fe()||a(1,{error:"Offline. Please check your network settings. "}),setTimeout(o,D)}function c(e,n){n("object"==typeof e&&e.error&&e.message&&e.payload?{message:e.message,payload:e.payload}:e)}function u(e,n,t){if("object"==typeof e){if(e.error&&e.message&&e.payload)return void t({message:e.message,payload:e.payload});if(e.payload)return void n(e.payload)}n(e)}function s(e){var n=0;return N(va(Y),function(t){(t=Y[t])&&(n++,(e||C())(t))}),n}function f(e){if(ie){if(!H.length)return}else{if(e&&(H.j=0),H.j||!H.length)return;H.j=1}ce(H.shift())}function l(){!ae&&b()}function b(){clearTimeout(ne),!re||re>=500||1>re||!va(Y,y).length?ae=A:(ae=y,ge.presence_heartbeat({callback:function(){ne=setTimeout(b,re*D)},error:function(e){se&&se("Presence Heartbeat unable to reach Pubnub servers."+JSON.stringify(e)),ne=setTimeout(b,re*D)}}))}function d(e,n){return pe.decrypt(e,n||de)||pe.decrypt(e,de)||e}function h(e,n,t){var r=A;if("number"==typeof e)r=e>5||0==e?A:y;else{if("boolean"==typeof e)return e?30:0;r=y}return r?(t&&t("Presence Heartbeat value invalid. Valid range ( x > 5 or x = 0). Current Value : "+(n||5)),n||5):e}function p(e){var n="",t=[];N(e,function(e){t.push(e)});var r,a=t.sort();for(r in a){var i=a[r],n=n+(i+"="+encodeURIComponent(e[i]));r!=a.length-1&&(n+="&")}return n}function g(e){return e||(e={}),N(ue,function(n,t){n in e||(e[n]=t)}),e}function v(e){return Jb(e)}function m(e){function n(e,n){var t=(65535&e)+(65535&n);return(e>>16)+(n>>16)+(t>>16)<<16|65535&t}function t(e,n){return e>>>n|e<<32-n}var r;r=e.replace(/\r\n/g,"\n");for(var e="",a=0;a<r.length;a++){var i=r.charCodeAt(a);128>i?e+=String.fromCharCode(i):(i>127&&2048>i?e+=String.fromCharCode(i>>6|192):(e+=String.fromCharCode(i>>12|224),e+=String.fromCharCode(i>>6&63|128)),e+=String.fromCharCode(63&i|128))}for(a=e,r=[],i=0;i<8*a.length;i+=8)r[i>>5]|=(255&a.charCodeAt(i/8))<<24-i%32;var o,c,u,s,f,l,b,d,h,p,g,y=8*e.length,a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],e=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],i=Array(64);for(r[y>>5]|=128<<24-y%32,r[(y+64>>9<<4)+15]=y,d=0;d<r.length;d+=16){for(y=e[0],o=e[1],c=e[2],u=e[3],s=e[4],f=e[5],l=e[6],b=e[7],h=0;64>h;h++)i[h]=16>h?r[h+d]:n(n(n(t(i[h-2],17)^t(i[h-2],19)^i[h-2]>>>10,i[h-7]),t(i[h-15],7)^t(i[h-15],18)^i[h-15]>>>3),i[h-16]),p=n(n(n(n(b,t(s,6)^t(s,11)^t(s,25)),s&f^~s&l),a[h]),i[h]),g=n(t(y,2)^t(y,13)^t(y,22),y&o^y&c^o&c),b=l,l=f,f=s,s=n(u,p),u=c,c=o,o=y,y=n(p,g);e[0]=n(y,e[0]),e[1]=n(o,e[1]),e[2]=n(c,e[2]),e[3]=n(u,e[3]),e[4]=n(s,e[4]),e[5]=n(f,e[5]),e[6]=n(l,e[6]),e[7]=n(b,e[7])}for(r="",a=0;a<4*e.length;a++)r+="0123456789abcdef".charAt(e[a>>2]>>8*(3-a%4)+4&15)+"0123456789abcdef".charAt(e[a>>2]>>8*(3-a%4)&15);return r}e.jsonp&&(ub=0);var _=e.subscribe_key||"";e.uuid||Eb.get(_+"uuid");var w=e.leave_on_unload||0;e.xdr=Ab,e.db=Eb,e.error=e.error||nb,e._is_online=Cb,e.jsonp_cb=zb,e.hmac_SHA256=lb,O.size(256);var S=O.s2a("0123456789012345");e.crypto_obj={encrypt:function(e,n){if(!n)return e;var t=O.s2a(m(n).slice(0,32)),r=O.s2a(JSON.stringify(e)),t=O.rawEncrypt(r,t,S);return O.Base64.encode(t)||e},decrypt:function(e,n){if(!n)return e;var t=O.s2a(m(n).slice(0,32));try{var r=O.Base64.decode(e),a=O.rawDecrypt(r,t,S,A);return JSON.parse(a)}catch(i){}}},e.params={pnsdk:"PubNub-JS-Web/3.6.7"};var x=+e.windowing||10,M=(+e.timeout||310)*D,T=(+e.keepalive||60)*D,U=e.noleave||0,B=e.publish_key||"demo",j=e.subscribe_key||"demo",E=e.auth_key||"",P=e.secret_key||"",I=e.hmac_SHA256,J=e.ssl?"s":"",L="http"+J+"://"+(e.origin||"pubsub.pubnub.com"),R=ma(L),K=ma(L),H=[],q=0,$=0,F=0,Q=0,W=e.restore||0,Z=0,X=A,Y={},ee={},ne=z,te=h(e.heartbeat||e.pnexpires||0,e.error),re=e.heartbeat_interval||te-3,ae=A,ie=e.no_wait_for_pending,oe=e["compatible_3.5"]||A,ce=e.xdr,ue=e.params||{},se=e.error||C(),fe=e._is_online||function(){return 1},le=e.jsonp_cb||function(){return 0},be=e.db||{get:C(),set:C()},de=e.cipher_key,he=e.uuid||be&&be.get(j+"uuid")||"",pe=e.crypto_obj||{encrypt:function(e){return e},decrypt:function(e){return e}},ge={LEAVE:function(e,n,t,r){var a={uuid:he,auth:E},i=ma(L),t=t||C(),o=r||C(),r=le();return 0<e.indexOf(ha)?y:oe&&(!J||"0"==r)||U?A:("0"!=r&&(a.callback=r),ce({h:n||J,timeout:2e3,a:r,data:g(a),c:function(e){u(e,t,o)},b:function(e){c(e,o)},url:[i,"v2","presence","sub_key",j,"channel",encodeURIComponent(e),"leave"]}),y)},set_resumed:function(e){X=e},get_cipher_key:function(){return de},set_cipher_key:function(e){de=e},raw_encrypt:function(e,n){return pe.encrypt(e,n||de)||e},raw_decrypt:function(e,n){return d(e,n)},get_heartbeat:function(){return te},set_heartbeat:function(e){te=h(e,re,se),re=te-3>=1?te-3:1,t(),b()},get_heartbeat_interval:function(){return re},set_heartbeat_interval:function(e){re=e,b()},get_version:function(){return"3.6.7"},getGcmMessageObject:function(e){return{data:e}},getApnsMessageObject:function(e){var n={aps:{badge:1,alert:""}};for(k in e)k[n]=e[k];return n},newPnMessage:function(){var e={};gcm&&(e.pn_gcm=gcm),apns&&(e.pn_apns=apns);for(k in n)e[k]=n[k];return e},_add_param:function(e,n){ue[e]=n},history:function(e,n){var n=e.callback||n,t=e.count||e.limit||100,r=e.reverse||"false",a=e.error||C(),i=e.auth_key||E,o=e.cipher_key,u=e.channel,s=e.start,f=e.end,l=e.include_token,b={},h=le();return u?n?j?(b.stringtoken="true",b.count=t,b.reverse=r,b.auth=i,h&&(b.callback=h),s&&(b.start=s),f&&(b.end=f),l&&(b.include_token="true"),void ce({a:h,data:g(b),c:function(e){if("object"==typeof e&&e.error)a({message:e.message,payload:e.payload});else{for(var t=e[0],r=[],i=0;i<t.length;i++){var c=d(t[i],o);try{r.push(JSON.parse(c))}catch(u){r.push(c)}}n([r,e[1],e[2]])}},b:function(e){c(e,a)},url:[R,"v2","history","sub-key",j,"channel",encodeURIComponent(u)]})):se("Missing Subscribe Key"):se("Missing Callback"):se("Missing Channel")},replay:function(e,n){var n=n||e.callback||C(),t=e.auth_key||E,r=e.source,a=e.destination,i=e.stop,o=e.start,c=e.end,s=e.reverse,f=e.limit,l=le(),b={};return r?a?B?j?("0"!=l&&(b.callback=l),i&&(b.stop="all"),s&&(b.reverse="true"),o&&(b.start=o),c&&(b.end=c),f&&(b.count=f),b.auth=t,void ce({a:l,c:function(e){u(e,n,err)},b:function(){n([0,"Disconnected"])},url:[R,"v1","replay",B,j,r,a],data:g(b)})):se("Missing Subscribe Key"):se("Missing Publish Key"):se("Missing Destination Channel"):se("Missing Source Channel")},auth:function(e){E=e,t()},time:function(e){var n=le();ce({a:n,data:g({uuid:he,auth:E}),timeout:5*D,url:[R,"time",n],c:function(n){e(n[0])},b:function(){e(0)}})},publish:function(e,n){var t=e.message;if(!t)return se("Missing Message");var n=n||e.callback||t.callback||C(),r=e.channel||t.channel,a=e.auth_key||E,i=e.cipher_key,o=e.error||t.error||C(),s=e.post||A,l="store_in_history"in e?e.store_in_history:y,b=le(),d="push";return e.prepend&&(d="unshift"),r?B?j?(t.getPubnubMessage&&(t=t.getPubnubMessage()),t=JSON.stringify(pe.encrypt(t,i||de)||t),t=[R,"publish",B,j,0,encodeURIComponent(r),b,encodeURIComponent(t)],ue={uuid:he,auth:a},l||(ue.store="0"),H[d]({a:b,timeout:5*D,url:t,data:g(ue),b:function(e){c(e,o),f(1)},c:function(e){u(e,n,o),f(1)},mode:s?"POST":"GET"}),void f()):se("Missing Subscribe Key"):se("Missing Publish Key"):se("Missing Channel")},unsubscribe:function(e,n){var r=e.channel,n=n||e.callback||C(),a=e.error||C();Z=0,r=ua((r.join?r.join(","):""+r).split(","),function(e){return Y[e]?e+","+e+ha:void 0}).join(","),N(r.split(","),function(e){var t=y;e&&(fa&&(t=ge.LEAVE(e,0,n,a)),t||n({action:"leave"}),Y[e]=0,e in ee&&delete ee[e])}),t()},subscribe:function(e,n){function r(e){e?setTimeout(t,D):(R=ma(L,1),K=ma(L,1),setTimeout(function(){ge.time(r)},D)),s(function(n){return e&&n.d?(n.d=0,n.p(n.name)):void(!e&&!n.d&&(n.d=1,n.o(n.name)))})}function i(){var e=le(),n=va(Y).join(",");if(n){a();var o=g({uuid:he,auth:u});2<JSON.stringify(ee).length&&(o.state=JSON.stringify(ee)),te&&(o.heartbeat=te),l(),Q=ce({timeout:k,a:e,b:function(e){c(e,p),ge.time(r)},data:g(o),url:[K,"subscribe",j,encodeURIComponent(n),e,Z],c:function(e){if(!e||"object"==typeof e&&"error"in e&&e.error)return p(e.error),setTimeout(t,D);if(y(e[1]),Z=!Z&&W&&be.get(j)||e[1],s(function(e){e.g||(e.g=1,e.n(e.name))}),X&&!W)Z=0,X=A,be.set(j,0);else{_&&(Z=1e4,_=0),be.set(j,e[1]);var n,r=(2<e.length?e[2]:ua(va(Y),function(n){return ua(Array(e[0].length).join(",").split(","),function(){return n})}).join(",")).split(",");n=function(){var e=r.shift()||F;return[(Y[e]||{}).a||$,e.split(ha)[0]]};var a=G()-q-+e[1]/1e4;N(e[0],function(t){var r=n(),t=d(t,Y[r[1]]?Y[r[1]].cipher_key:z);r[0](t,e,r[1],a)})}setTimeout(i,S)}})}}var o=e.channel,n=(n=n||e.callback)||e.message,u=e.auth_key||E,f=e.connect||C(),b=e.reconnect||C(),h=e.disconnect||C(),p=e.error||C(),y=e.idle||C(),v=e.presence||0,m=e.noheresync||0,_=e.backfill||0,w=e.timetoken||0,k=e.timeout||M,S=e.windowing||x,O=e.state,T=e.heartbeat||e.pnexpires,U=e.restore||W;return W=U,Z=w,o?n?j?((T||0===T)&&ge.set_heartbeat(T),N((o.join?o.join(","):""+o).split(","),function(t){var r=Y[t]||{};Y[F=t]={name:t,g:r.g,d:r.d,f:1,a:$=n,cipher_key:e.cipher_key,n:f,o:h,p:b},O&&(ee[t]=t in O?O[t]:O),v&&(ge.subscribe({channel:t+ha,callback:v,restore:U}),!r.f&&!m&&ge.here_now({channel:t,callback:function(e){N("uuids"in e?e.uuids:[],function(n){v({action:"join",uuid:n,timestamp:Math.floor(G()/1e3),occupancy:e.occupancy||1},e,t)})}}))}),t=function(){a(),setTimeout(i,S)},fa?void t():ga.push(t)):se("Missing Subscribe Key"):se("Missing Callback"):se("Missing Channel")},here_now:function(e,n){var n=e.callback||n,t=e.error||C(),r=e.auth_key||E,a=e.channel,i=le(),o=e.state,r={uuid:he,auth:r};return("uuids"in e?e.uuids:1)||(r.disable_uuids=1),o&&(r.state=1),n?j?(o=[R,"v2","presence","sub_key",j],a&&o.push("channel")&&o.push(encodeURIComponent(a)),"0"!=i&&(r.callback=i),void ce({a:i,data:g(r),c:function(e){u(e,n,t)},b:function(e){c(e,t)},url:o})):se("Missing Subscribe Key"):se("Missing Callback")},where_now:function(e,n){var n=e.callback||n,t=e.error||C(),r=e.auth_key||E,a=le(),i=e.uuid||he,r={auth:r};return n?j?("0"!=a&&(r.callback=a),void ce({a:a,data:g(r),c:function(e){u(e,n,t)},b:function(e){c(e,t);
},url:[R,"v2","presence","sub_key",j,"uuid",encodeURIComponent(i)]})):se("Missing Subscribe Key"):se("Missing Callback")},state:function(e,n){var n=e.callback||n||C(),t=e.error||C(),r=e.auth_key||E,a=le(),i=e.state,o=e.uuid||he,s=e.channel,r=g({auth:r});return j?o?s?("0"!=a&&(r.callback=a),Y[s]&&Y[s].f&&i&&(ee[s]=i),r.state=JSON.stringify(i),i=i?[R,"v2","presence","sub-key",j,"channel",encodeURIComponent(s),"uuid",o,"data"]:[R,"v2","presence","sub-key",j,"channel",encodeURIComponent(s),"uuid",encodeURIComponent(o)],void ce({a:a,data:g(r),c:function(e){u(e,n,t)},b:function(e){c(e,t)},url:i})):se("Missing Channel"):se("Missing UUID"):se("Missing Subscribe Key")},grant:function(e,n){var n=e.callback||n,t=e.error||C(),r=e.channel,a=le(),i=e.ttl,o=e.read?"1":"0",s=e.write?"1":"0",f=e.auth_key;if(!n)return se("Missing Callback");if(!j)return se("Missing Subscribe Key");if(!B)return se("Missing Publish Key");if(!P)return se("Missing Secret Key");var l=j+"\n"+B+"\ngrant\n",o={w:s,r:o,timestamp:Math.floor((new Date).getTime()/1e3)};"undefined"!=r&&r!=z&&0<r.length&&(o.channel=r),"0"!=a&&(o.callback=a),(i||0===i)&&(o.ttl=i),f&&(o.auth=f),o=g(o),f||delete o.auth,l+=p(o),r=I(l,P),r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),o.signature=r,ce({a:a,data:o,c:function(e){u(e,n,t)},b:function(e){c(e,t)},url:[R,"v1","auth","grant","sub-key",j]})},audit:function(e,n){var n=e.callback||n,t=e.error||C(),r=e.channel,a=e.auth_key,i=le();if(!n)return se("Missing Callback");if(!j)return se("Missing Subscribe Key");if(!B)return se("Missing Publish Key");if(!P)return se("Missing Secret Key");var o=j+"\n"+B+"\naudit\n",s={timestamp:Math.floor((new Date).getTime()/1e3)};"0"!=i&&(s.callback=i),"undefined"!=r&&r!=z&&0<r.length&&(s.channel=r),a&&(s.auth=a),s=g(s),a||delete s.auth,o+=p(s),r=I(o,P),r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),s.signature=r,ce({a:i,data:s,c:function(e){u(e,n,t)},b:function(e){c(e,t)},url:[R,"v1","auth","audit","sub-key",j]})},revoke:function(e,n){e.read=A,e.write=A,ge.grant(e,n)},set_uuid:function(e){he=e,t()},get_uuid:function(){return he},presence_heartbeat:function(e){var n=e.callback||C(),t=e.error||C(),e=le(),r={uuid:he,auth:E};2<JSON.stringify(ee).length&&(r.state=JSON.stringify(ee)),te>0&&320>te&&(r.heartbeat=te),"0"!=e&&(r.callback=e);var a=ce,r=g(r),i=5*D,o=R,s=j,f=va(Y,y).join(",");a({a:e,data:r,timeout:i,url:[o,"v2","presence","sub-key",s,"channel",encodeURIComponent(f),"heartbeat"],c:function(e){u(e,n,t)},b:function(e){c(e,t)}})},xdr:ce,ready:wa,db:be,uuid:pa,map:ua,each:N,"each-channel":s,grep:sa,offline:function(){a(1,{message:"Offline. Please check your network settings."})},supplant:ta,now:G,unique:la,updater:ra};he||(he=ge.uuid()),be.set(j+"uuid",he),setTimeout(o,D),setTimeout(i,T),ne=setTimeout(l,(re-3)*D),r();var ye,_=ge;for(ye in _)_.hasOwnProperty(ye)&&(v[ye]=_[ye]);return v.css=sb,v.$=mb,v.create=tb,v.bind=qb,v.head=rb,v.search=pb,v.attr=V,v.events=Gb,v.init=v,v.secure=v,qb("beforeunload",window,function(){return w&&v["each-channel"](function(e){v.LEAVE(e.name,0)}),y}),e.notest?v:(qb("offline",window,v.offline),qb("offline",document,v.offline),v)};Jb.init=Jb,Jb.secure=Jb,"complete"===document.readyState?setTimeout(wa,0):qb("load",window,function(){setTimeout(wa,0)});var Kb=Ib||{};PUBNUB=Jb({notest:1,publish_key:V(Kb,"pub-key"),subscribe_key:V(Kb,"sub-key"),ssl:!document.location.href.indexOf("https")||"on"==V(Kb,"ssl"),origin:V(Kb,"origin"),uuid:V(Kb,"uuid")}),window.jQuery&&(window.jQuery.PUBNUB=Jb),"undefined"!=typeof module&&(module.exports=PUBNUB)&&wa();var Db=mb("pubnubs")||0;Ib&&(sb(Ib,{position:"absolute",top:-D}),("opera"in window||V(Ib,"flash"))&&(Ib.innerHTML="<object id=pubnubs data=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=movie value=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=allowscriptaccess value=always></object>"),PUBNUB.rdx=function(e,n){return n?($[e].responseText=unescape(n),void $[e].onload()):$[e].onerror()},$.id=D)}var Mb=PUBNUB.ws=function(e,n){if(!(this instanceof Mb))return new Mb(e,n);var t=this,e=t.url=e||"";t.protocol=n||"Sec-WebSocket-Protocol";var r=e.split("/"),r={ssl:"wss:"===r[0],origin:r[2],publish_key:r[3],subscribe_key:r[4],channel:r[5]};return t.CONNECTING=0,t.OPEN=1,t.CLOSING=2,t.CLOSED=3,t.CLOSE_NORMAL=1e3,t.CLOSE_GOING_AWAY=1001,t.CLOSE_PROTOCOL_ERROR=1002,t.CLOSE_UNSUPPORTED=1003,t.CLOSE_TOO_LARGE=1004,t.CLOSE_NO_STATUS=1005,t.CLOSE_ABNORMAL=1006,t.onclose=t.onerror=t.onmessage=t.onopen=t.onsend=C(),t.binaryType="",t.extensions="",t.bufferedAmount=0,t.trasnmitting=A,t.buffer=[],t.readyState=t.CONNECTING,e?(t.e=PUBNUB.init(r),t.e.k=r,t.k=r,void t.e.subscribe({restore:A,channel:r.channel,disconnect:t.onerror,reconnect:t.onopen,error:function(){t.onclose({code:t.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:A})},callback:function(e){t.onmessage({data:e})},connect:function(){t.readyState=t.OPEN,t.onopen()}})):(t.readyState=t.CLOSED,t.onclose({code:t.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:y}),t)};Mb.prototype.send=function(e){var n=this;n.e.publish({channel:n.e.k.channel,message:e,callback:function(e){n.onsend({data:e})}})}}();

